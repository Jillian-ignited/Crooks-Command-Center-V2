<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crooks & Castles Command Center V2</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            min-height: 100vh;
        }
        .header {
            background: rgba(0,0,0,0.2);
            padding: 1rem;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .header p {
            opacity: 0.8;
            font-size: 1.1rem;
        }
        .nav-tabs {
            display: flex;
            background: rgba(0,0,0,0.1);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .nav-tab {
            flex: 1;
            padding: 1rem;
            background: none;
            border: none;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            border-bottom: 3px solid transparent;
        }
        .nav-tab:hover {
            background: rgba(255,255,255,0.1);
        }
        .nav-tab.active {
            background: rgba(255,255,255,0.2);
            border-bottom-color: #ff6b6b;
        }
        .content {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .metric-card {
            background: rgba(255,255,255,0.1);
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 0.5rem;
        }
        .metric-label {
            opacity: 0.8;
            font-size: 0.9rem;
        }
        .section {
            background: rgba(255,255,255,0.1);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .section h3 {
            margin-bottom: 1rem;
            color: #ff6b6b;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .hashtag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .hashtag {
            background: rgba(255,107,107,0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            border: 1px solid rgba(255,107,107,0.3);
        }
        .competitor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }
        .competitor-card {
            background: rgba(255,255,255,0.05);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .competitor-name {
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #ff6b6b;
        }
        .competitor-stats {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        .calendar-controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        .calendar-btn {
            padding: 0.5rem 1rem;
            background: rgba(255,107,107,0.2);
            border: 1px solid rgba(255,107,107,0.3);
            color: #fff;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .calendar-btn:hover, .calendar-btn.active {
            background: rgba(255,107,107,0.4);
        }
        .campaign-card {
            background: rgba(255,255,255,0.05);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid #ff6b6b;
        }
        .campaign-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #ff6b6b;
        }
        .campaign-details {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        .loading {
            text-align: center;
            padding: 2rem;
            opacity: 0.7;
        }
        .error {
            color: #ff6b6b;
            text-align: center;
            padding: 1rem;
        }
        .priority-action {
            background: rgba(255,107,107,0.1);
            border-left: 4px solid #ff6b6b;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0 8px 8px 0;
        }
        .priority-title {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 0.5rem;
        }
        .recommendation {
            background: rgba(255,107,107,0.1);
            border-left: 4px solid #ff6b6b;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0 8px 8px 0;
        }
        .recommendation-title {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üè∞ Crooks & Castles Command Center V2</h1>
        <p>Advanced Competitive Intelligence & Content Planning Platform</p>
    </div>
    
    <div class="nav-tabs">
        <button class="nav-tab active" onclick="showTab('overview')">üìä Overview</button>
        <button class="nav-tab" onclick="showTab('intelligence')">üéØ Intelligence</button>
        <button class="nav-tab" onclick="showTab('assets')">üìÅ Assets</button>
        <button class="nav-tab" onclick="showTab('calendar')">üìÖ Calendar</button>
        <button class="nav-tab" onclick="showTab('agency')">üè¢ Agency</button>
    </div>
    
    <div class="content">
        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <h2>Executive Overview Dashboard</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="data-sources">-</div>
                    <div class="metric-label">Data Sources</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="trust-score">-</div>
                    <div class="metric-label">Trustworthiness Score</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="total-assets">-</div>
                    <div class="metric-label">Total Assets</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="upcoming-events">-</div>
                    <div class="metric-label">Upcoming Events</div>
                </div>
            </div>
            
            <div class="section">
                <h3>üìä Executive Summary</h3>
                <div id="executive-summary">Loading executive insights...</div>
            </div>
            
            <div class="section">
                <h3>üéØ Priority Actions</h3>
                <div id="priority-actions">Loading priority actions...</div>
            </div>
        </div>
        
        <!-- Intelligence Tab -->
        <div id="intelligence" class="tab-content">
            <h2>Competitive Intelligence</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="posts-analyzed">-</div>
                    <div class="metric-label">Posts Analyzed</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="sentiment-analyzed">-</div>
                    <div class="metric-label">Sentiment Analyzed</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="positive-sentiment">-</div>
                    <div class="metric-label">Positive Sentiment</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="trends-tracked">-</div>
                    <div class="metric-label">Trends Tracked</div>
                </div>
            </div>
            
            <div class="section">
                <h3>üî• Top Trending Hashtags</h3>
                <div class="hashtag-list" id="trending-hashtags">Loading hashtags...</div>
            </div>
            
            <div class="section">
                <h3>üí° Strategic Recommendations</h3>
                <div id="strategic-recommendations">Loading recommendations...</div>
            </div>
            
            <div class="section">
                <h3>üèÜ Competitor Analysis</h3>
                <div id="competitor-analysis">Loading competitor data...</div>
            </div>
        </div>
        
        <!-- Assets Tab -->
        <div id="assets" class="tab-content">
            <h2>Asset Management</h2>
            <div id="asset-content">Loading assets...</div>
        </div>
        
        <!-- Calendar Tab -->
        <div id="calendar" class="tab-content">
            <h2>Strategic Calendar</h2>
            <div class="calendar-controls">
                <button class="calendar-btn active" onclick="loadCalendar('7')">7 Days</button>
                <button class="calendar-btn" onclick="loadCalendar('30')">30 Days</button>
                <button class="calendar-btn" onclick="loadCalendar('60')">60 Days</button>
                <button class="calendar-btn" onclick="loadCalendar('90')">90+ Days</button>
            </div>
            <div id="calendar-content">Loading calendar...</div>
        </div>
        
        <!-- Agency Tab -->
        <div id="agency" class="tab-content">
            <h2>Agency Workflow</h2>
            <div id="agency-content">Loading agency data...</div>
        </div>
    </div>
    
    <script>
        // Global variables to track loaded data
        let currentTab = 'overview';
        let dataLoaded = {
            overview: false,
            intelligence: false,
            assets: false,
            calendar: false,
            agency: false
        };

        // Auto-load data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing dashboard...');
            loadOverview();
        });

        // Tab switching
        function showTab(tabName) {
            console.log('Switching to tab:', tabName);
            
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Update current tab
            currentTab = tabName;
            
            // Load tab content if not already loaded
            loadTabContent(tabName);
        }
        
        // Load tab content
        function loadTabContent(tabName) {
            if (dataLoaded[tabName]) {
                console.log('Data already loaded for', tabName);
                return;
            }

            switch(tabName) {
                case 'overview':
                    loadOverview();
                    break;
                case 'intelligence':
                    loadIntelligence();
                    break;
                case 'assets':
                    loadAssets();
                    break;
                case 'calendar':
                    loadCalendar('7');
                    break;
                case 'agency':
                    loadAgency();
                    break;
            }
        }
        
        // Load overview data
        function loadOverview() {
            console.log('Loading overview data...');
            
            fetch('/api/overview')
                .then(response => {
                    console.log('Overview API response status:', response.status);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Overview data received:', data);
                    
                    // Update metrics
                    updateElement('data-sources', data.data_sources || '0');
                    updateElement('trust-score', '85%');
                    updateElement('total-assets', data.data_sources || '0');
                    updateElement('upcoming-events', '3');
                    
                    // Executive summary
                    const summary = data.executive_summary || {};
                    const summaryHtml = `
                        <p><strong>Analysis Summary:</strong> ${summary.summary || 'Processing competitive intelligence data'}</p>
                        <p><strong>Key Insights:</strong> ${summary.key_takeaways ? summary.key_takeaways.join(' ') : 'Analyzing market trends and competitor performance'}</p>
                    `;
                    updateElement('executive-summary', summaryHtml, true);
                    
                    // Priority actions
                    if (summary.recommendations) {
                        const actionsHtml = summary.recommendations.map(rec => `
                            <div class="priority-action">
                                <div class="priority-title">Strategic Action</div>
                                <div>${rec}</div>
                            </div>
                        `).join('');
                        updateElement('priority-actions', actionsHtml, true);
                    }
                    
                    dataLoaded.overview = true;
                    console.log('Overview data loaded successfully');
                })
                .catch(error => {
                    console.error('Error loading overview:', error);
                    updateElement('executive-summary', '<div class="error">Error loading overview data. Please refresh the page.</div>', true);
                });
        }
        
        // Load intelligence data
        function loadIntelligence() {
            console.log('Loading intelligence data...');
            
            // Load main intelligence data
            fetch('/api/intelligence')
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return response.json();
                })
                .then(data => {
                    console.log('Intelligence data received:', data);
                    
                    updateElement('posts-analyzed', data.posts_analyzed || '0');
                    updateElement('sentiment-analyzed', data.sentiment_analyzed || '0');
                    updateElement('positive-sentiment', (data.positive_sentiment || '0') + '%');
                    updateElement('trends-tracked', data.trends_tracked || '0');
                    
                    // Trending hashtags
                    if (data.trending_hashtags) {
                        const hashtagsHtml = data.trending_hashtags.map(tag => 
                            `<span class="hashtag">${tag.hashtag || tag[0] || tag} <small>(${tag.count || tag[1] || ''})</small></span>`
                        ).join('');
                        updateElement('trending-hashtags', hashtagsHtml, true);
                    }
                    
                    // Strategic recommendations
                    if (data.strategic_recommendations) {
                        const recommendationsHtml = data.strategic_recommendations.map(rec => `
                            <div class="recommendation">
                                <div class="recommendation-title">${rec.title || 'Strategic Insight'}</div>
                                <div>${rec.description || rec}</div>
                            </div>
                        `).join('');
                        updateElement('strategic-recommendations', recommendationsHtml, true);
                    }
                })
                .catch(error => {
                    console.error('Error loading intelligence:', error);
                });
            
            // Load competitor analysis
            fetch('/api/intelligence/competitors')
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return response.json();
                })
                .then(data => {
                    console.log('Competitor data received:', data);
                    
                    const competitors = data.competitors || [];
                    const competitorHtml = `
                        <p>Tracking <strong>${competitors.length}</strong> brands across <strong>${data.total_posts || 0}</strong> posts</p>
                        <div class="competitor-grid">
                            ${competitors.map(comp => `
                                <div class="competitor-card">
                                    <div class="competitor-name">${comp.name || comp[0] || 'Unknown Brand'}</div>
                                    <div class="competitor-stats">
                                        Posts: ${comp.posts || comp[1]?.posts || 0}<br>
                                        Avg Engagement: ${comp.avg_engagement || comp[1]?.avg_engagement || 0}<br>
                                        Sentiment: ${comp.avg_sentiment || comp[1]?.avg_sentiment || 0}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    updateElement('competitor-analysis', competitorHtml, true);
                    
                    dataLoaded.intelligence = true;
                })
                .catch(error => {
                    console.error('Error loading competitors:', error);
                    updateElement('competitor-analysis', '<div class="error">Error loading competitor data</div>', true);
                });
        }
        
        // Load assets
        function loadAssets() {
            console.log('Loading assets data...');
            
            fetch('/api/assets')
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return response.json();
                })
                .then(data => {
                    console.log('Assets data received:', data);
                    
                    const assetsHtml = `
                        <div class="section">
                            <h3>üìä Data Assets</h3>
                            <p>Total Files: ${data.data_assets?.length || 0}</p>
                            <p>Total Records: ${data.total_records || 0}</p>
                        </div>
                        <div class="section">
                            <h3>üé® Media Assets</h3>
                            <p>Total Files: ${data.media_assets?.length || 0}</p>
                        </div>
                    `;
                    updateElement('asset-content', assetsHtml, true);
                    
                    dataLoaded.assets = true;
                })
                .catch(error => {
                    console.error('Error loading assets:', error);
                    updateElement('asset-content', '<div class="error">Error loading assets data</div>', true);
                });
        }
        
        // Load calendar
        function loadCalendar(timeframe) {
            console.log('Loading calendar data for timeframe:', timeframe);
            
            // Update active button
            document.querySelectorAll('.calendar-btn').forEach(btn => btn.classList.remove('active'));
            event?.target?.classList.add('active');
            
            fetch(`/api/calendar/${timeframe}`)
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return response.json();
                })
                .then(data => {
                    console.log('Calendar data received:', data);
                    
                    const calendarHtml = `
                        <div class="section">
                            <h3>üìÖ Upcoming Campaigns</h3>
                            ${data.campaigns ? data.campaigns.map(campaign => `
                                <div class="campaign-card">
                                    <div class="campaign-title">${campaign.title || campaign.name}</div>
                                    <div class="campaign-details">
                                        Launch: ${campaign.start_date || campaign.launch_date}<br>
                                        Target: ${campaign.target || campaign.goal}<br>
                                        Budget: $${campaign.budget || 'TBD'}
                                    </div>
                                </div>
                            `).join('') : '<p>No campaigns scheduled</p>'}
                        </div>
                    `;
                    updateElement('calendar-content', calendarHtml, true);
                    
                    dataLoaded.calendar = true;
                })
                .catch(error => {
                    console.error('Error loading calendar:', error);
                    updateElement('calendar-content', '<div class="error">Error loading calendar data</div>', true);
                });
        }
        
        // Load agency
        function loadAgency() {
            console.log('Loading agency data...');
            
            fetch('/api/agency')
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return response.json();
                })
                .then(data => {
                    console.log('Agency data received:', data);
                    
                    const agencyHtml = `
                        <div class="section">
                            <h3>üè¢ Agency Partnership Status</h3>
                            <p><strong>Current Stage:</strong> ${data.current_stage || 'Active Partnership'}</p>
                            <p><strong>Monthly Budget:</strong> $${data.monthly_budget || '7,500'}</p>
                            <p><strong>Progress:</strong> ${data.progress || '75'}%</p>
                        </div>
                        <div class="section">
                            <h3>üìã Active Deliverables</h3>
                            ${data.deliverables ? data.deliverables.map(item => `
                                <div class="campaign-card">
                                    <div class="campaign-title">${item.title}</div>
                                    <div class="campaign-details">
                                        Status: ${item.status}<br>
                                        Due: ${item.due_date}<br>
                                        Assignee: ${item.assignee}
                                    </div>
                                </div>
                            `).join('') : '<p>No active deliverables</p>'}
                        </div>
                    `;
                    updateElement('agency-content', agencyHtml, true);
                    
                    dataLoaded.agency = true;
                })
                .catch(error => {
                    console.error('Error loading agency:', error);
                    updateElement('agency-content', '<div class="error">Error loading agency data</div>', true);
                });
        }
        
        // Helper function to update elements safely
        function updateElement(id, content, isHtml = false) {
            const element = document.getElementById(id);
            if (element) {
                if (isHtml) {
                    element.innerHTML = content;
                } else {
                    element.textContent = content;
                }
            } else {
                console.warn('Element not found:', id);
            }
        }
        
        // Refresh functions
        function refreshDashboard() {
            dataLoaded.overview = false;
            loadOverview();
        }
        
        function refreshIntelligence() {
            dataLoaded.intelligence = false;
            loadIntelligence();
        }
        
        // Error handling for network issues
        window.addEventListener('online', function() {
            console.log('Connection restored, refreshing current tab');
            dataLoaded[currentTab] = false;
            loadTabContent(currentTab);
        });
        
        console.log('Dashboard JavaScript initialized');
    </script>
    <script>
// Auto-load data when page loads
document.addEventListener('DOMContentLoaded', function() {
    console.log('Page loaded, initializing dashboard...');
    
    // Load overview data automatically
    fetch('/api/overview')
        .then(response => response.json())
        .then(data => {
            console.log('Overview data loaded:', data);
            // Your existing code will handle displaying this data
        })
        .catch(error => {
            console.error('Error loading overview:', error);
        });
});
</script>

</body>
</html>
