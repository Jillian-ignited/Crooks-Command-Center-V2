<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crooks Command Center V2</title>
  <style>
    /* Dark theme with professional styling */
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background-color: #0f0f0f;
      color: #f0f0f0;
      margin: 0;
      padding: 0;
      line-height: 1.6;
    }
    
    .header {
      background-color: #111;
      border-bottom: 1px solid #333;
      padding: 0.5rem 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .brand {
      font-size: 1.2rem;
      font-weight: 600;
      color: #f0f0f0;
      text-decoration: none;
    }
    
    .nav {
      display: flex;
      gap: 1rem;
    }
    
    .nav a {
      color: #ccc;
      text-decoration: none;
      padding: 0.5rem 0.75rem;
      border-radius: 4px;
      transition: background-color 0.2s;
    }
    
    .nav a:hover {
      background-color: #333;
      color: #fff;
    }
    
    .version {
      font-size: 0.8rem;
      color: #888;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1rem;
    }
    
    h1 {
      font-size: 2rem;
      margin-bottom: 2rem;
    }
    
    h2 {
      font-size: 1.5rem;
      margin-top: 2rem;
      margin-bottom: 1rem;
      border-bottom: 1px solid #333;
      padding-bottom: 0.5rem;
    }
    
    .module-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }
    
    .module-card {
      background-color: #1a1a1a;
      border-radius: 8px;
      padding: 1.5rem;
      transition: transform 0.2s, box-shadow 0.2s;
      position: relative;
      overflow: hidden;
    }
    
    .module-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    }
    
    .module-card a {
      color: #f0f0f0;
      text-decoration: none;
      display: block;
    }
    
    .module-card::before {
      content: attr(data-number);
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background-color: rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.7);
      width: 1.5rem;
      height: 1.5rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: bold;
    }
    
    /* Module-specific border colors */
    .module-card.executive {
      border-left: 4px solid #7b68ee;
    }
    
    .module-card.intelligence {
      border-left: 4px solid #ff6b6b;
    }
    
    .module-card.content {
      border-left: 4px solid #4ecdc4;
    }
    
    .module-card.asset {
      border-left: 4px solid #ff6b6b;
    }
    
    .module-card.upload {
      border-left: 4px solid #6c5ce7;
    }
    
    .module-card.calendar {
      border-left: 4px solid #00cec9;
    }
    
    .module-card.summary {
      border-left: 4px solid #00b894;
    }
    
    .module-card.agency {
      border-left: 4px solid #0984e3;
    }
    
    .module-card.shopify {
      border-left: 4px solid #fdcb6e;
    }
    
    /* Dashboard styles */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1rem;
    }
    
    .dashboard-card {
      background-color: #1a1a1a;
      border-radius: 8px;
      padding: 1.5rem;
    }
    
    .dashboard-card h3 {
      margin-top: 0;
      font-size: 1.2rem;
      border-bottom: 1px solid #333;
      padding-bottom: 0.5rem;
    }
    
    .metric {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }
    
    .metric-label {
      color: #ccc;
    }
    
    .metric-value {
      font-weight: bold;
    }
    
    .positive {
      color: #00b894;
    }
    
    .negative {
      color: #ff6b6b;
    }
    
    .neutral {
      color: #fdcb6e;
    }
    
    /* Table styles */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
    }
    
    th, td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid #333;
    }
    
    th {
      background-color: #222;
      font-weight: 600;
    }
    
    tr:hover {
      background-color: #222;
    }
    
    /* Form elements */
    input, select, button {
      background-color: #333;
      border: 1px solid #444;
      color: #f0f0f0;
      padding: 0.5rem 0.75rem;
      border-radius: 4px;
      font-family: inherit;
    }
    
    button {
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    button:hover {
      background-color: #444;
    }
    
    /* JSON formatting */
    .json-key { color: #f92672; }
    .json-value { color: #a6e22e; }
    .json-string { color: #e6db74; }
    .json-number { color: #ae81ff; }
    .json-boolean { color: #66d9ef; }
    .json-null { color: #fd971f; }
  </style>
</head>
<body>
  <div class="header">
    <a href="/" class="brand">Crooks Command Center</a>
    <div class="nav">
      <a href="/">Dashboard</a>
      <a href="/executive">Executive Overview</a>
      <a href="/intelligence">Intelligence</a>
      <a href="/summary">Executive Summary</a>
      <a href="/calendar">Calendar</a>
      <a href="/agency">Agency</a>
    </div>
    <div class="version">v2.1</div>
  </div>
  
  <div class="container">
    <h1>Crooks Command Center</h1>
    
    <h2>Choose a module:</h2>
    
    <div class="module-grid">
      <div class="module-card executive" data-number="7">
        <a href="/executive">Executive Overview →</a>
      </div>
      
      <div class="module-card intelligence" data-number="8">
        <a href="/intelligence">Intelligence →</a>
      </div>
      
      <div class="module-card content" data-number="9">
        <a href="/content">Content Creation →</a>
      </div>
      
      <div class="module-card asset" data-number="10">
        <a href="/media">Asset Library →</a>
      </div>
      
      <div class="module-card upload" data-number="11">
        <a href="/upload">Upload (Data & Media) →</a>
      </div>
      
      <div class="module-card calendar" data-number="12">
        <a href="/calendar">Calendar →</a>
      </div>
      
      <div class="module-card summary" data-number="13">
        <a href="/summary">Summary →</a>
      </div>
      
      <div class="module-card agency" data-number="14">
        <a href="/agency">Agency →</a>
      </div>
      
      <div class="module-card shopify" data-number="15">
        <a href="/shopify">Shopify →</a>
      </div>
    </div>
  </div>

  <!-- API Path Fixer -->
  <script>
    // Fix API paths by adding /api/ prefix to all fetch calls
    (function() {
      // Store the original fetch function
      const originalFetch = window.fetch;
      
      // Override the fetch function
      window.fetch = function(url, options) {
        // Only modify URLs that are relative and don't already start with /api/
        if (typeof url === 'string' && url.startsWith('/') && !url.startsWith('/api/') && !url.startsWith('/_next/')) {
          // Add /api/ prefix
          url = '/api' + url;
          console.log('Fixed API path:', url);
        }
        
        // Call the original fetch with the modified URL
        return originalFetch.call(this, url, options);
      };
      
      console.log('API path fixer installed');
    })();
  </script>

  <!-- JSON Formatter -->
  <script>
    // Format JSON responses for better display
    (function() {
      // Function to format JSON with syntax highlighting
      window.formatJSON = function(json) {
        if (typeof json !== 'string') {
          json = JSON.stringify(json, null, 2);
        }
        
        json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        
        return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function(match) {
          let cls = 'json-number';
          if (/^"/.test(match)) {
            if (/:$/.test(match)) {
              cls = 'json-key';
            } else {
              cls = 'json-string';
            }
          } else if (/true|false/.test(match)) {
            cls = 'json-boolean';
          } else if (/null/.test(match)) {
            cls = 'json-null';
          }
          return '<span class="' + cls + '">' + match + '</span>';
        });
      };
      
      // Find and format any JSON content in the page
      function formatJSONInPage() {
        // Look for elements with raw JSON content
        document.querySelectorAll('pre, code, .json-content').forEach(el => {
          try {
            const text = el.textContent.trim();
            if (text.startsWith('{') || text.startsWith('[')) {
              // Try to parse as JSON
              const json = JSON.parse(text);
              // Format with syntax highlighting
              el.innerHTML = formatJSON(json);
            }
          } catch (e) {
            // Not valid JSON, ignore
          }
        });
      }
      
      // Run formatter when page loads and after any XHR requests
      document.addEventListener('DOMContentLoaded', formatJSONInPage);
      
      // Monitor for DOM changes and format new JSON content
      const observer = new MutationObserver(mutations => {
        mutations.forEach(mutation => {
          if (mutation.addedNodes && mutation.addedNodes.length > 0) {
            formatJSONInPage();
          }
        });
      });
      
      // Start observing the document
      observer.observe(document.body, { childList: true, subtree: true });
      
      console.log('JSON formatter installed');
    })();
  </script>

  <!-- Intelligence Integration Layer -->
  <script>
    // Intelligence Integration Layer
    const IntelligenceLayer = {
      // Store data from all modules
      _data: {},
      
      // Initialize the intelligence layer
      initialize: async function() {
        console.log('Initializing Intelligence Layer...');
        
        try {
          // Fetch data from key modules
          await Promise.all([
            this._fetchModuleData('intelligence'),
            this._fetchModuleData('shopify'),
            this._fetchModuleData('executive'),
            this._fetchModuleData('content')
          ]);
          
          // Process cross-module insights
          this._generateCrossModuleInsights();
          
          console.log('Intelligence Layer initialized successfully');
          return true;
        } catch (error) {
          console.error('Intelligence Layer initialization failed:', error);
          return false;
        }
      },
      
      // Fetch data for a specific module
      _fetchModuleData: async function(module) {
        try {
          // Define endpoints for each module
          const endpoints = {
            intelligence: ['/api/intelligence/dashboard', '/api/intelligence/summary'],
            shopify: ['/api/shopify/analytics', '/api/shopify/products'],
            executive: ['/api/executive/overview'],
            content: ['/api/content/dashboard']
          };
          
          // Fetch data from all endpoints for this module
          const results = await Promise.all(
            (endpoints[module] || []).map(endpoint => 
              fetch(endpoint)
                .then(res => res.ok ? res.json() : null)
                .catch(err => {
                  console.warn(`Failed to fetch ${endpoint}:`, err);
                  return null;
                })
            )
          );
          
          // Combine results
          this._data[module] = results.reduce((acc, result) => {
            return result ? {...acc, ...result} : acc;
          }, {});
          
          console.log(`Loaded data for ${module} module`);
          return this._data[module];
        } catch (error) {
          console.error(`Failed to load ${module} data:`, error);
          this._data[module] = {};
          return null;
        }
      },
      
      // Generate cross-module insights
      _generateCrossModuleInsights: function() {
        const insights = [];
        
        // Connect intelligence data with shopify performance
        if (this._data.intelligence && this._data.shopify) {
          // Example: Connect trending topics with product performance
          if (this._data.intelligence.trending_topics && this._data.shopify.analytics?.top_products) {
            insights.push({
              type: 'product_trend_alignment',
              title: 'Product-Trend Alignment',
              description: 'Align product strategy with emerging trends in streetwear market',
              source: ['intelligence', 'shopify']
            });
          }
        }
        
        // Connect content strategy with sales performance
        if (this._data.content && this._data.shopify) {
          insights.push({
            type: 'content_sales_correlation',
            title: 'Content-Sales Correlation',
            description: 'Content strategy should focus on top-performing product categories',
            source: ['content', 'shopify']
          });
        }
        
        // Store insights
        this._data.cross_module_insights = insights;
        console.log(`Generated ${insights.length} cross-module insights`);
      },
      
      // Get data for a specific module
      getModuleData: function(module) {
        return this._data[module] || null;
      },
      
      // Get cross-module insights
      getInsights: function() {
        return this._data.cross_module_insights || [];
      }
    };

    // Initialize the intelligence layer when the page is fully loaded
    document.addEventListener('DOMContentLoaded', function() {
      IntelligenceLayer.initialize().then(() => {
        console.log('Intelligence integration complete');
      }).catch(error => {
        console.error('Intelligence initialization error:', error);
      });
    });
  </script>
</body>
</html>
