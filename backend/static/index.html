<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crooks Command Center V2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .loading { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .card { background: linear-gradient(135deg, #1f2937 0%, #374151 100%); }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div id="app">
        <header class="bg-gray-800 shadow-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-6">
                    <h1 class="text-3xl font-bold text-blue-400">Crooks Command Center V2</h1>
                    <div id="status-indicator" class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-green-500 rounded-full loading"></div>
                        <span class="text-sm text-gray-300">System Operational</span>
                    </div>
                </div>
            </div>
        </header>

        <nav class="bg-gray-800 border-b border-gray-700">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-8 py-4">
                    <button onclick="showSection('intelligence')" class="nav-btn text-blue-400 border-b-2 border-blue-400 pb-2">Intelligence</button>
                    <button onclick="showSection('executive')" class="nav-btn text-gray-300 hover:text-white pb-2">Executive</button>
                    <button onclick="showSection('content')" class="nav-btn text-gray-300 hover:text-white pb-2">Content</button>
                    <button onclick="showSection('agency')" class="nav-btn text-gray-300 hover:text-white pb-2">Agency</button>
                    <button onclick="showSection('calendar')" class="nav-btn text-gray-300 hover:text-white pb-2">Calendar</button>
                    <button onclick="showSection('media')" class="nav-btn text-gray-300 hover:text-white pb-2">Media</button>
                    <button onclick="showSection('shopify')" class="nav-btn text-gray-300 hover:text-white pb-2">Shopify</button>
                    <button onclick="showSection('summary')" class="nav-btn text-gray-300 hover:text-white pb-2">Summary</button>
                </div>
            </div>
        </nav>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div id="content-area">
                <!-- Content will be loaded here -->
            </div>
        </main>
    </div>

    <script>
        // FIXED API Client - No more double slashes
        class APIClient {
            constructor() {
                this.baseURL = window.location.origin;
            }

            async request(endpoint, options = {}) {
                // Clean up endpoint to prevent double slashes
                const cleanEndpoint = endpoint.startsWith('/') ? endpoint : '/' + endpoint;
                const url = this.baseURL + cleanEndpoint;
                
                try {
                    const response = await fetch(url, {
                        headers: {
                            'Content-Type': 'application/json',
                            ...options.headers
                        },
                        ...options
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error(`API Error for ${url}:`, error);
                    return { success: false, error: error.message };
                }
            }

            // Specific API methods with proper URL construction
            async getIntelligenceDashboard() {
                return this.request('/api/intelligence/dashboard');
            }

            async getIntelligenceSummary() {
                return this.request('/intelligence/summary?brands=all');
            }

            async getExecutiveOverview() {
                return this.request('/api/executive/overview?days=30');
            }

            async getContentDashboard() {
                return this.request('/api/content/dashboard');
            }

            async getAgencyDashboard() {
                return this.request('/api/agency/dashboard');
            }

            async getCalendarUpcoming() {
                return this.request('/api/calendar/upcoming');
            }

            async getMediaLibrary() {
                return this.request('/api/media/library');
            }

            async getShopifyAnalytics() {
                return this.request('/api/shopify/analytics');
            }

            async getSummaryDashboard() {
                return this.request('/api/summary/dashboard');
            }

            async getSystemStatus() {
                return this.request('/api/status');
            }
        }

        const api = new APIClient();
        let currentSection = 'intelligence';

        // Navigation
        function showSection(section) {
            currentSection = section;
            
            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.className = 'nav-btn text-gray-300 hover:text-white pb-2';
            });
            event.target.className = 'nav-btn text-blue-400 border-b-2 border-blue-400 pb-2';
            
            // Load section content
            loadSectionContent(section);
        }

        async function loadSectionContent(section) {
            const contentArea = document.getElementById('content-area');
            contentArea.innerHTML = '<div class="text-center py-8"><div class="loading text-blue-400">Loading...</div></div>';
            
            try {
                switch(section) {
                    case 'intelligence':
                        await loadIntelligenceSection();
                        break;
                    case 'executive':
                        await loadExecutiveSection();
                        break;
                    case 'content':
                        await loadContentSection();
                        break;
                    case 'agency':
                        await loadAgencySection();
                        break;
                    case 'calendar':
                        await loadCalendarSection();
                        break;
                    case 'media':
                        await loadMediaSection();
                        break;
                    case 'shopify':
                        await loadShopifySection();
                        break;
                    case 'summary':
                        await loadSummarySection();
                        break;
                }
            } catch (error) {
                contentArea.innerHTML = `<div class="text-red-400 text-center py-8">Error loading ${section}: ${error.message}</div>`;
            }
        }

        async function loadIntelligenceSection() {
            const [dashboard, summary] = await Promise.all([
                api.getIntelligenceDashboard(),
                api.getIntelligenceSummary()
            ]);

            document.getElementById('content-area').innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="card p-6 rounded-lg">
                        <h2 class="text-xl font-semibold mb-4 text-blue-400">Competitive Analysis</h2>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span>Total Competitors:</span>
                                <span class="font-semibold">${dashboard.dashboard?.competitive_analysis?.total_competitors || 0}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Active Campaigns:</span>
                                <span class="font-semibold">${dashboard.dashboard?.competitive_analysis?.active_campaigns || 0}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Market Share Trend:</span>
                                <span class="font-semibold text-green-400">${dashboard.dashboard?.competitive_analysis?.market_share_trend || 'N/A'}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card p-6 rounded-lg">
                        <h2 class="text-xl font-semibold mb-4 text-blue-400">Performance Metrics</h2>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span>Intelligence Accuracy:</span>
                                <span class="font-semibold">${dashboard.dashboard?.performance_metrics?.intelligence_accuracy || 'N/A'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Data Freshness:</span>
                                <span class="font-semibold">${dashboard.dashboard?.performance_metrics?.data_freshness || 'N/A'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Coverage Score:</span>
                                <span class="font-semibold">${dashboard.dashboard?.performance_metrics?.coverage_score || 'N/A'}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        async function loadExecutiveSection() {
            const data = await api.getExecutiveOverview();
            
            document.getElementById('content-area').innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="card p-6 rounded-lg">
                        <h2 class="text-xl font-semibold mb-4 text-blue-400">Revenue Metrics</h2>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span>Total Sales:</span>
                                <span class="font-semibold">$${data.shopify_metrics?.total_sales || 0}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Total Orders:</span>
                                <span class="font-semibold">${data.shopify_metrics?.total_orders || 0}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>AOV:</span>
                                <span class="font-semibold">$${data.shopify_metrics?.aov || 0}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card p-6 rounded-lg">
                        <h2 class="text-xl font-semibold mb-4 text-blue-400">Alerts</h2>
                        <div class="space-y-2">
                            ${data.alerts?.map(alert => `
                                <div class="p-3 rounded ${alert.level === 'critical' ? 'bg-red-900' : 'bg-yellow-900'}">
                                    <div class="font-semibold">${alert.message}</div>
                                    <div class="text-sm text-gray-300">${alert.action}</div>
                                </div>
                            `).join('') || '<div class="text-gray-400">No alerts</div>'}
                        </div>
                    </div>
                    
                    <div class="card p-6 rounded-lg">
                        <h2 class="text-xl font-semibold mb-4 text-blue-400">Data Sources</h2>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span>Shopify:</span>
                                <span class="font-semibold ${data.data_sources?.shopify ? 'text-green-400' : 'text-red-400'}">
                                    ${data.data_sources?.shopify ? 'Connected' : 'Disconnected'}
                                </span>
                            </div>
                            <div class="flex justify-between">
                                <span>Competitive:</span>
                                <span class="font-semibold ${data.data_sources?.competitive ? 'text-green-400' : 'text-red-400'}">
                                    ${data.data_sources?.competitive ? 'Connected' : 'Disconnected'}
                                </span>
                            </div>
                            <div class="flex justify-between">
                                <span>Social:</span>
                                <span class="font-semibold ${data.data_sources?.social ? 'text-green-400' : 'text-red-400'}">
                                    ${data.data_sources?.social ? 'Connected' : 'Disconnected'}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        async function loadContentSection() {
            const data = await api.getContentDashboard();
            
            document.getElementById('content-area').innerHTML = `
                <div class="card p-6 rounded-lg">
                    <h2 class="text-xl font-semibold mb-4 text-blue-400">Content Performance</h2>
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-blue-400">${data.content_performance?.total_content || 0}</div>
                            <div class="text-sm text-gray-400">Total Content</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-400">${data.content_performance?.published_content || 0}</div>
                            <div class="text-sm text-gray-400">Published</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-yellow-400">${data.content_performance?.draft_content || 0}</div>
                            <div class="text-sm text-gray-400">Drafts</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-purple-400">${data.content_performance?.scheduled_content || 0}</div>
                            <div class="text-sm text-gray-400">Scheduled</div>
                        </div>
                    </div>
                </div>
            `;
        }

        async function loadAgencySection() {
            const data = await api.getAgencyDashboard();
            
            document.getElementById('content-area').innerHTML = `
                <div class="card p-6 rounded-lg">
                    <h2 class="text-xl font-semibold mb-4 text-blue-400">Agency Overview</h2>
                    <div class="space-y-4">
                        <div>
                            <h3 class="font-semibold">Agency: ${data.agency_info?.name || 'N/A'}</h3>
                            <p class="text-gray-400">${data.agency_info?.description || 'No description available'}</p>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <div class="text-lg font-bold text-blue-400">${data.performance_metrics?.projects_completed || 0}</div>
                                <div class="text-sm text-gray-400">Projects Completed</div>
                            </div>
                            <div>
                                <div class="text-lg font-bold text-green-400">${data.performance_metrics?.client_satisfaction || 'N/A'}</div>
                                <div class="text-sm text-gray-400">Client Satisfaction</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        async function loadCalendarSection() {
            const data = await api.getCalendarUpcoming();
            
            document.getElementById('content-area').innerHTML = `
                <div class="card p-6 rounded-lg">
                    <h2 class="text-xl font-semibold mb-4 text-blue-400">Upcoming Events</h2>
                    <div class="space-y-3">
                        ${data.upcoming_events?.map(event => `
                            <div class="p-3 bg-gray-800 rounded">
                                <div class="font-semibold">${event.title}</div>
                                <div class="text-sm text-gray-400">${new Date(event.date).toLocaleDateString()}</div>
                                <div class="text-xs text-blue-400">${event.type} - ${event.priority} priority</div>
                            </div>
                        `).join('') || '<div class="text-gray-400">No upcoming events</div>'}
                    </div>
                </div>
            `;
        }

        async function loadMediaSection() {
            const data = await api.getMediaLibrary();
            
            document.getElementById('content-area').innerHTML = `
                <div class="card p-6 rounded-lg">
                    <h2 class="text-xl font-semibold mb-4 text-blue-400">Media Library</h2>
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-blue-400">${data.library?.total_assets || 0}</div>
                            <div class="text-sm text-gray-400">Total Assets</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-400">${data.library?.categories?.images || 0}</div>
                            <div class="text-sm text-gray-400">Images</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-purple-400">${data.library?.categories?.videos || 0}</div>
                            <div class="text-sm text-gray-400">Videos</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-yellow-400">${data.library?.categories?.documents || 0}</div>
                            <div class="text-sm text-gray-400">Documents</div>
                        </div>
                    </div>
                </div>
            `;
        }

        async function loadShopifySection() {
            const data = await api.getShopifyAnalytics();
            
            document.getElementById('content-area').innerHTML = `
                <div class="card p-6 rounded-lg">
                    <h2 class="text-xl font-semibold mb-4 text-blue-400">Shopify Analytics</h2>
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-400">$${data.analytics?.revenue?.total_sales || 0}</div>
                            <div class="text-sm text-gray-400">Total Sales</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-blue-400">${data.analytics?.revenue?.total_orders || 0}</div>
                            <div class="text-sm text-gray-400">Orders</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-purple-400">$${data.analytics?.revenue?.average_order_value || 0}</div>
                            <div class="text-sm text-gray-400">AOV</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-yellow-400">${data.analytics?.revenue?.conversion_rate || 'N/A'}</div>
                            <div class="text-sm text-gray-400">Conversion</div>
                        </div>
                    </div>
                </div>
            `;
        }

        async function loadSummarySection() {
            const data = await api.getSummaryDashboard();
            
            document.getElementById('content-area').innerHTML = `
                <div class="card p-6 rounded-lg">
                    <h2 class="text-xl font-semibold mb-4 text-blue-400">Performance Summary</h2>
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-blue-400">${data.summary?.total_content || 0}</div>
                            <div class="text-sm text-gray-400">Total Content</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-400">${data.summary?.active_campaigns || 0}</div>
                            <div class="text-sm text-gray-400">Active Campaigns</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-purple-400">${data.summary?.key_metrics?.engagement_rate || 'N/A'}</div>
                            <div class="text-sm text-gray-400">Engagement Rate</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-yellow-400">${data.summary?.monthly_performance || 'N/A'}</div>
                            <div class="text-sm text-gray-400">Monthly Growth</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadSectionContent('intelligence');
            
            // Update system status
            api.getSystemStatus().then(status => {
                if (status.status === 'operational') {
                    document.getElementById('status-indicator').innerHTML = `
                        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                        <span class="text-sm text-gray-300">All ${status.modules?.length || 0} modules operational</span>
                    `;
                }
            });
        });
    </script>
</body>
</html>
