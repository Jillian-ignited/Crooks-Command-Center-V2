<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crooks & Castles Command Center V2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'crooks-black': '#0a0a0a',
                        'crooks-orange': '#ff6b35',
                        'crooks-gold': '#ffd700',
                        'crooks-gray': '#1a1a1a'
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-border {
            background: linear-gradient(45deg, #ff6b35, #ffd700, #ff6b35);
            padding: 2px;
            border-radius: 12px;
        }
        .gradient-border-content {
            background: #0a0a0a;
            border-radius: 10px;
            padding: 1.5rem;
        }
        .glow-effect {
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.3);
        }
        .health-excellent { color: #10b981; }
        .health-good { color: #3b82f6; }
        .health-fair { color: #f59e0b; }
        .health-needs-attention { color: #ef4444; }
        .priority-1 { border-left: 4px solid #ef4444; background: rgba(239, 68, 68, 0.1); }
        .priority-2 { border-left: 4px solid #f59e0b; background: rgba(245, 158, 11, 0.1); }
        .priority-3 { border-left: 4px solid #10b981; background: rgba(16, 185, 129, 0.1); }
        .impact-high { color: #ef4444; font-weight: bold; }
        .impact-medium { color: #f59e0b; font-weight: bold; }
        .impact-low { color: #10b981; font-weight: bold; }
        .tab-active {
            background: linear-gradient(45deg, #ff6b35, #ffd700);
            color: #0a0a0a;
            font-weight: bold;
        }
        .loading-spinner {
            border: 2px solid #1a1a1a;
            border-top: 2px solid #ff6b35;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-crooks-black text-white min-h-screen">
    <!-- Header -->
    <header class="bg-crooks-gray border-b border-crooks-orange/30 p-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <h1 class="text-2xl font-bold text-crooks-orange">üëë Crooks & Castles Command Center V2</h1>
                <div id="systemStatus" class="flex items-center space-x-2">
                    <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                    <span class="text-sm text-gray-300">System Online</span>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <div id="shopifyStatus" class="flex items-center space-x-2">
                    <div class="w-3 h-3 bg-gray-500 rounded-full"></div>
                    <span class="text-sm text-gray-300">Shopify: Checking...</span>
                </div>
                <div class="text-sm text-gray-400">
                    Last Updated: <span id="lastUpdated">Loading...</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="bg-crooks-gray border-b border-crooks-orange/30">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex space-x-1">
                <button onclick="showTab('overview')" id="tab-overview" class="tab-button px-6 py-3 text-sm font-medium rounded-t-lg transition-all duration-200 tab-active">
                    üìä Executive Overview
                </button>
                <button onclick="showTab('intelligence')" id="tab-intelligence" class="tab-button px-6 py-3 text-sm font-medium rounded-t-lg transition-all duration-200 text-gray-300 hover:text-white">
                    üß† Intelligence
                </button>
                <button onclick="showTab('revenue')" id="tab-revenue" class="tab-button px-6 py-3 text-sm font-medium rounded-t-lg transition-all duration-200 text-gray-300 hover:text-white">
                    üí∞ Revenue Intelligence
                </button>
                <button onclick="showTab('calendar')" id="tab-calendar" class="tab-button px-6 py-3 text-sm font-medium rounded-t-lg transition-all duration-200 text-gray-300 hover:text-white">
                    üìÖ Calendar
                </button>
                <button onclick="showTab('assets')" id="tab-assets" class="tab-button px-6 py-3 text-sm font-medium rounded-t-lg transition-all duration-200 text-gray-300 hover:text-white">
                    üìÅ Asset Library
                </button>
                <button onclick="showTab('agency')" id="tab-agency" class="tab-button px-6 py-3 text-sm font-medium rounded-t-lg transition-all duration-200 text-gray-300 hover:text-white">
                    ü§ù Agency Tracking
                </button>
                <button onclick="showTab('ingest')" id="tab-ingest" class="tab-button px-6 py-3 text-sm font-medium rounded-t-lg transition-all duration-200 text-gray-300 hover:text-white">
                    ‚¨ÜÔ∏è Data Ingest
                </button>
                <button onclick="showTab('shopify-setup')" id="tab-shopify-setup" class="tab-button px-6 py-3 text-sm font-medium rounded-t-lg transition-all duration-200 text-gray-300 hover:text-white">
                    üõí Shopify Setup
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto p-6">
        
        <!-- Executive Overview Tab -->
        <div id="overview-tab" class="tab-content">
            <!-- Health Score Banner -->
            <div class="gradient-border mb-6 glow-effect">
                <div class="gradient-border-content">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2 class="text-xl font-bold text-crooks-orange mb-2">üéØ Strategic Health Score</h2>
                            <div class="flex items-center space-x-4">
                                <div class="text-3xl font-bold" id="healthScore">--</div>
                                <div class="text-sm" id="healthStatus">Loading...</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-gray-400">Overall Performance</div>
                            <div class="w-32 h-2 bg-gray-700 rounded-full mt-1">
                                <div id="healthBar" class="h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Key Metrics Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400 text-sm">Posts Analyzed</p>
                            <p class="text-2xl font-bold text-white" id="totalPosts">--</p>
                        </div>
                        <div class="text-crooks-orange text-2xl">üìä</div>
                    </div>
                </div>
                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400 text-sm">Brands Tracked</p>
                            <p class="text-2xl font-bold text-white" id="totalBrands">--</p>
                        </div>
                        <div class="text-crooks-orange text-2xl">üè¢</div>
                    </div>
                </div>
                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400 text-sm">Sentiment Score</p>
                            <p class="text-2xl font-bold text-white" id="sentimentScore">--%</p>
                        </div>
                        <div class="text-crooks-orange text-2xl">üòä</div>
                    </div>
                </div>
                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400 text-sm">C&C Ranking</p>
                            <p class="text-2xl font-bold text-white" id="crooksRanking">--</p>
                        </div>
                        <div class="text-crooks-orange text-2xl">üëë</div>
                    </div>
                </div>
            </div>

            <!-- Prioritized Actions -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="gradient-border">
                    <div class="gradient-border-content">
                        <h3 class="text-lg font-bold text-crooks-orange mb-4">üéØ Top 3 Prioritized Actions</h3>
                        <div id="prioritizedActions" class="space-y-3">
                            <div class="text-center text-gray-400 py-8">Loading strategic recommendations...</div>
                        </div>
                    </div>
                </div>

                <div class="gradient-border">
                    <div class="gradient-border-content">
                        <h3 class="text-lg font-bold text-crooks-orange mb-4">üìà Strategic Analysis</h3>
                        <div id="strategicAnalysis" class="space-y-3">
                            <div class="text-center text-gray-400 py-8">Loading market analysis...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trending Hashtags -->
            <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                <h3 class="text-lg font-bold text-crooks-orange mb-4">üî• Trending Hashtags</h3>
                <div id="trendingHashtags" class="flex flex-wrap gap-2">
                    <div class="text-center text-gray-400 py-4 w-full">Loading trending hashtags...</div>
                </div>
            </div>
        </div>

        <!-- Intelligence Tab -->
        <div id="intelligence-tab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <h3 class="text-lg font-bold text-crooks-orange mb-4">üèÜ Competitor Rankings</h3>
                    <div id="competitorRankings" class="space-y-3">
                        <div class="text-center text-gray-400 py-8">Loading competitor analysis...</div>
                    </div>
                </div>

                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <h3 class="text-lg font-bold text-crooks-orange mb-4">üìä Strategic Insights</h3>
                    <div id="strategicInsights" class="space-y-3">
                        <div class="text-center text-gray-400 py-8">Loading strategic insights...</div>
                    </div>
                </div>
            </div>

            <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                <h3 class="text-lg font-bold text-crooks-orange mb-4">üéØ Content Opportunities</h3>
                <div id="contentOpportunities" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="text-center text-gray-400 py-8 col-span-full">Loading content opportunities...</div>
                </div>
            </div>
        </div>

        <!-- Revenue Intelligence Tab -->
        <div id="revenue-tab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <h3 class="text-lg font-bold text-crooks-orange mb-4">üí∞ Revenue Metrics</h3>
                    <div id="revenueMetrics" class="space-y-3">
                        <div class="text-center text-gray-400 py-8">Loading revenue data...</div>
                    </div>
                </div>

                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <h3 class="text-lg font-bold text-crooks-orange mb-4">üìä Conversion Funnel</h3>
                    <div id="conversionFunnel" class="space-y-3">
                        <div class="text-center text-gray-400 py-8">Loading conversion data...</div>
                    </div>
                </div>

                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <h3 class="text-lg font-bold text-crooks-orange mb-4">üéØ Social ROI</h3>
                    <div id="socialROI" class="space-y-3">
                        <div class="text-center text-gray-400 py-8">Loading social ROI...</div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <h3 class="text-lg font-bold text-crooks-orange mb-4">üìà Revenue Correlation</h3>
                    <div id="revenueCorrelation" class="space-y-3">
                        <div class="text-center text-gray-400 py-8">Loading correlation analysis...</div>
                    </div>
                </div>

                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <h3 class="text-lg font-bold text-crooks-orange mb-4">üéØ Optimization Opportunities</h3>
                    <div id="optimizationOpportunities" class="space-y-3">
                        <div class="text-center text-gray-400 py-8">Loading optimization insights...</div>
                    </div>
                </div>
            </div>

            <!-- Sync Controls -->
            <div class="mt-6 bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                <h3 class="text-lg font-bold text-crooks-orange mb-4">üîÑ Data Sync Controls</h3>
                <div class="flex space-x-4">
                    <button onclick="syncShopifyData('sales')" class="bg-crooks-orange text-crooks-black px-4 py-2 rounded-lg font-medium hover:bg-orange-600 transition-colors">
                        Sync Sales Data
                    </button>
                    <button onclick="syncShopifyData('traffic')" class="bg-crooks-orange text-crooks-black px-4 py-2 rounded-lg font-medium hover:bg-orange-600 transition-colors">
                        Sync Traffic Data
                    </button>
                    <button onclick="loadRevenueIntelligence()" class="bg-gray-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-gray-700 transition-colors">
                        Refresh Dashboard
                    </button>
                </div>
            </div>
        </div>

        <!-- Calendar Tab -->
        <div id="calendar-tab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <h3 class="text-lg font-bold text-crooks-orange mb-4">üìÖ Strategic Calendar Views</h3>
                    <div class="space-y-3">
                        <button onclick="loadCalendarView('7-day')" class="w-full text-left p-3 bg-crooks-black rounded-lg hover:bg-gray-800 transition-colors">
                            üìä 7-Day Tactical View
                        </button>
                        <button onclick="loadCalendarView('30-day')" class="w-full text-left p-3 bg-crooks-black rounded-lg hover:bg-gray-800 transition-colors">
                            üìà 30-Day Strategic View
                        </button>
                        <button onclick="loadCalendarView('60-day')" class="w-full text-left p-3 bg-crooks-black rounded-lg hover:bg-gray-800 transition-colors">
                            üéØ 60-Day Campaign View
                        </button>
                        <button onclick="loadCalendarView('90-day')" class="w-full text-left p-3 bg-crooks-black rounded-lg hover:bg-gray-800 transition-colors">
                            üöÄ 90-Day Vision View
                        </button>
                        <button onclick="loadCalendarView('quarterly')" class="w-full text-left p-3 bg-crooks-black rounded-lg hover:bg-gray-800 transition-colors">
                            üëë Quarterly Strategic Planning
                        </button>
                    </div>
                </div>

                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <h3 class="text-lg font-bold text-crooks-orange mb-4">üé® Content Creation Tools</h3>
                    <div class="space-y-3">
                        <button onclick="generateContent('campaign')" class="w-full text-left p-3 bg-crooks-black rounded-lg hover:bg-gray-800 transition-colors">
                            üéØ Campaign Generator
                        </button>
                        <button onclick="generateContent('trend')" class="w-full text-left p-3 bg-crooks-black rounded-lg hover:bg-gray-800 transition-colors">
                            üìà Trend Analysis
                        </button>
                        <button onclick="generateContent('calendar')" class="w-full text-left p-3 bg-crooks-black rounded-lg hover:bg-gray-800 transition-colors">
                            üìÖ Content Calendar Creator
                        </button>
                        <button onclick="generateContent('cultural')" class="w-full text-left p-3 bg-crooks-black rounded-lg hover:bg-gray-800 transition-colors">
                            üåç Cultural Moment Planner
                        </button>
                    </div>
                </div>
            </div>

            <div id="calendarContent" class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                <h3 class="text-lg font-bold text-crooks-orange mb-4">üìÖ Calendar Content</h3>
                <div class="text-center text-gray-400 py-8">Select a calendar view or content tool to get started</div>
            </div>
        </div>

        <!-- Asset Library Tab -->
        <div id="assets-tab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <h3 class="text-lg font-bold text-crooks-orange mb-2">üìÅ Total Files</h3>
                    <div class="text-2xl font-bold" id="totalFiles">--</div>
                </div>
                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <h3 class="text-lg font-bold text-crooks-orange mb-2">üíæ Total Size</h3>
                    <div class="text-2xl font-bold" id="totalSize">-- MB</div>
                </div>
                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <h3 class="text-lg font-bold text-crooks-orange mb-2">üìä Total Records</h3>
                    <div class="text-2xl font-bold" id="totalRecords">--</div>
                </div>
            </div>

            <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30 mb-6">
                <h3 class="text-lg font-bold text-crooks-orange mb-4">‚¨ÜÔ∏è Upload New Assets</h3>
                <div class="border-2 border-dashed border-crooks-orange/50 rounded-lg p-8 text-center">
                    <input type="file" id="assetFileInput" class="hidden" accept=".json,.jsonl,.csv,.txt,.jpg,.jpeg,.png,.gif,.mp4,.mov,.pdf,.doc,.docx" multiple>
                    <button onclick="document.getElementById('assetFileInput').click()" class="bg-crooks-orange text-crooks-black px-6 py-3 rounded-lg font-medium hover:bg-orange-600 transition-colors">
                        üìÅ Select Files to Upload
                    </button>
                    <p class="text-gray-400 mt-2">Supports: JSON, JSONL, CSV, Images, Videos, Documents</p>
                </div>
            </div>

            <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                <h3 class="text-lg font-bold text-crooks-orange mb-4">üìö Asset Library</h3>
                <div id="assetLibrary" class="space-y-3">
                    <div class="text-center text-gray-400 py-8">Loading asset library...</div>
                </div>
            </div>
        </div>

        <!-- Agency Tracking Tab -->
        <div id="agency-tab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="gradient-border">
                    <div class="gradient-border-content">
                        <h3 class="text-lg font-bold text-crooks-orange mb-4">ü§ù HVD Partnership Dashboard</h3>
                        <div id="hvdPartnership" class="space-y-4">
                            <div class="text-center text-gray-400 py-8">Loading partnership data...</div>
                        </div>
                    </div>
                </div>

                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <h3 class="text-lg font-bold text-crooks-orange mb-4">üìä Performance Metrics</h3>
                    <div id="agencyMetrics" class="space-y-3">
                        <div class="text-center text-gray-400 py-8">Loading performance metrics...</div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <h3 class="text-lg font-bold text-crooks-orange mb-4">üìã Deliverables Tracking</h3>
                    <div id="deliverablesTracking" class="space-y-3">
                        <div class="text-center text-gray-400 py-8">Loading deliverables...</div>
                    </div>
                </div>

                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <h3 class="text-lg font-bold text-crooks-orange mb-4">üéØ Strategic Goals</h3>
                    <div id="strategicGoals" class="space-y-3">
                        <div class="text-center text-gray-400 py-8">Loading strategic goals...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Ingest Tab -->
        <div id="ingest-tab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <h3 class="text-lg font-bold text-crooks-orange mb-4">üìÅ File Upload</h3>
                    <div class="border-2 border-dashed border-crooks-orange/50 rounded-lg p-6 text-center">
                        <input type="file" id="fileInput" class="hidden" accept=".json,.jsonl,.csv,.txt" multiple>
                        <button onclick="document.getElementById('fileInput').click()" class="bg-crooks-orange text-crooks-black px-6 py-3 rounded-lg font-medium hover:bg-orange-600 transition-colors mb-4">
                            üìÅ Select Files
                        </button>
                        <p class="text-gray-400 text-sm">Supports: JSON, JSONL, CSV, TXT</p>
                    </div>
                </div>

                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <h3 class="text-lg font-bold text-crooks-orange mb-4">üìù JSON Paste</h3>
                    <textarea id="jsonPasteArea" class="w-full h-32 bg-crooks-black border border-crooks-orange/30 rounded-lg p-3 text-white resize-none" placeholder='Paste JSON data here...
Example:
[
  {"brand": "example", "text": "content"},
  {"brand": "example2", "text": "content2"}
]'></textarea>
                    <button onclick="processJsonPaste()" class="mt-3 bg-crooks-orange text-crooks-black px-6 py-2 rounded-lg font-medium hover:bg-orange-600 transition-colors">
                        üöÄ Process JSON
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <h3 class="text-lg font-bold text-crooks-orange mb-4">üìä Processing Status</h3>
                    <div id="processingStatus" class="space-y-3">
                        <div class="text-gray-400">No recent processing activity</div>
                    </div>
                </div>

                <div class="bg-crooks-gray p-6 rounded-lg border border-crooks-orange/30">
                    <h3 class="text-lg font-bold text-crooks-orange mb-4">üîç System Health</h3>
                    <div id="systemHealth" class="space-y-3">
                        <div class="text-gray-400">Checking system status...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Shopify Setup Tab -->
        <div id="shopify-setup-tab" class="tab-content hidden">
            <div class="max-w-2xl mx-auto">
                <div class="bg-crooks-gray p-8 rounded-lg border border-crooks-orange/30">
                    <h3 class="text-2xl font-bold text-crooks-orange mb-6">üõí Shopify Integration Setup</h3>
                    
                    <div id="shopifyConnectionStatus" class="mb-6 p-4 rounded-lg bg-crooks-black border border-gray-600">
                        <div class="flex items-center space-x-3">
                            <div class="w-4 h-4 bg-gray-500 rounded-full"></div>
                            <span>Checking connection status...</span>
                        </div>
                    </div>

                    <form id="shopifySetupForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Shop URL</label>
                            <input type="text" id="shopUrl" class="w-full bg-crooks-black border border-crooks-orange/30 rounded-lg p-3 text-white" placeholder="your-shop.myshopify.com">
                            <p class="text-gray-400 text-sm mt-1">Enter your Shopify store URL (without https://)</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Access Token</label>
                            <input type="password" id="accessToken" class="w-full bg-crooks-black border border-crooks-orange/30 rounded-lg p-3 text-white" placeholder="shpat_...">
                            <p class="text-gray-400 text-sm mt-1">Private app access token from your Shopify admin</p>
                        </div>

                        <div class="flex space-x-4">
                            <button type="button" onclick="testShopifyConnection()" class="bg-gray-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-gray-700 transition-colors">
                                üîç Test Connection
                            </button>
                            <button type="button" onclick="saveShopifyConfig()" class="bg-crooks-orange text-crooks-black px-6 py-3 rounded-lg font-medium hover:bg-orange-600 transition-colors">
                                üíæ Save Configuration
                            </button>
                        </div>
                    </form>

                    <div class="mt-8 p-4 bg-crooks-black rounded-lg border border-gray-600">
                        <h4 class="font-bold text-crooks-orange mb-2">üìã Setup Instructions:</h4>
                        <ol class="text-sm text-gray-300 space-y-1 list-decimal list-inside">
                            <li>Go to your Shopify Admin ‚Üí Apps ‚Üí Develop apps</li>
                            <li>Create a private app with Admin API access</li>
                            <li>Enable permissions for: Orders (read), Products (read), Analytics (read)</li>
                            <li>Copy the Admin API access token</li>
                            <li>Enter your shop URL and access token above</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Global state
        let currentTab = 'overview';
        let dataLoaded = {
            overview: false,
            intelligence: false,
            revenue: false,
            calendar: false,
            assets: false,
            agency: false
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Crooks & Castles Command Center V2 initializing...');
            updateLastUpdated();
            checkSystemHealth();
            checkShopifyStatus();
            loadOverviewData();
            setupFileUpload();
            setupAssetFileUpload();
        });

        function updateLastUpdated() {
            document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString();
        }

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });

            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('tab-active');
                button.classList.add('text-gray-300', 'hover:text-white');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.remove('hidden');

            // Add active class to selected tab button
            const activeButton = document.getElementById('tab-' + tabName);
            activeButton.classList.add('tab-active');
            activeButton.classList.remove('text-gray-300', 'hover:text-white');

            currentTab = tabName;

            // Load data for tab if not already loaded
            if (!dataLoaded[tabName]) {
                switch(tabName) {
                    case 'overview':
                        loadOverviewData();
                        break;
                    case 'intelligence':
                        loadIntelligenceData();
                        break;
                    case 'revenue':
                        loadRevenueIntelligence();
                        break;
                    case 'calendar':
                        loadCalendarData();
                        break;
                    case 'assets':
                        loadAssetLibrary();
                        break;
                    case 'agency':
                        loadAgencyData();
                        break;
                }
            }
        }

        async function loadOverviewData() {
            try {
                console.log('Loading overview data...');
                const response = await fetch('/summary/overview');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Overview data loaded:', data);

                // Update health score
                const healthScore = data.health_score || 0;
                const healthStatus = data.health_status || 'Unknown';
                document.getElementById('healthScore').textContent = healthScore + '/100';
                document.getElementById('healthStatus').textContent = healthStatus;
                document.getElementById('healthStatus').className = `health-${healthStatus.toLowerCase().replace(' ', '-')}`;
                
                // Update health bar
                const healthBar = document.getElementById('healthBar');
                healthBar.style.width = healthScore + '%';
                if (healthScore >= 80) healthBar.className = 'h-2 rounded-full transition-all duration-500 bg-green-500';
                else if (healthScore >= 60) healthBar.className = 'h-2 rounded-full transition-all duration-500 bg-blue-500';
                else if (healthScore >= 40) healthBar.className = 'h-2 rounded-full transition-all duration-500 bg-yellow-500';
                else healthBar.className = 'h-2 rounded-full transition-all duration-500 bg-red-500';

                // Update key metrics
                document.getElementById('totalPosts').textContent = data.key_metrics?.total_posts || 0;
                document.getElementById('totalBrands').textContent = data.key_metrics?.total_brands || 0;
                document.getElementById('sentimentScore').textContent = (data.key_metrics?.sentiment_score || 0) + '%';
                document.getElementById('crooksRanking').textContent = '#' + (data.key_metrics?.crooks_ranking || '--');

                // Update prioritized actions
                displayPrioritizedActions(data.prioritized_actions || []);

                // Update strategic analysis
                displayStrategicAnalysis(data.strategic_analysis || {});

                // Update trending hashtags
                displayTrendingHashtags(data.trending_hashtags || []);

                dataLoaded.overview = true;
                updateLastUpdated();

            } catch (error) {
                console.error('Error loading overview data:', error);
                showErrorMessage('overview', 'Failed to load overview data: ' + error.message);
            }
        }

        function displayPrioritizedActions(actions) {
            const container = document.getElementById('prioritizedActions');
            if (!actions || actions.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-4">No prioritized actions available</div>';
                return;
            }

            container.innerHTML = actions.map((action, index) => `
                <div class="priority-${action.priority} p-4 rounded-lg">
                    <div class="flex justify-between items-start mb-2">
                        <div class="font-bold text-white">${index + 1}. ${action.title}</div>
                        <div class="flex space-x-2">
                            <span class="impact-${action.impact.toLowerCase()} text-xs px-2 py-1 rounded">${action.impact}</span>
                            <span class="text-xs px-2 py-1 rounded bg-gray-600 text-white">${action.timeline}</span>
                        </div>
                    </div>
                    <div class="text-gray-300 text-sm">${action.description}</div>
                    <div class="text-xs text-gray-400 mt-2">Category: ${action.category}</div>
                </div>
            `).join('');
        }

        function displayStrategicAnalysis(analysis) {
            const container = document.getElementById('strategicAnalysis');
            const items = [
                { label: 'Market Position', value: analysis.market_position || 'Analyzing...' },
                { label: 'Content Performance', value: analysis.content_performance || 'Analyzing...' },
                { label: 'Trend Analysis', value: analysis.trend_analysis || 'Analyzing...' },
                { label: 'Cultural Insights', value: analysis.cultural_insights || 'Analyzing...' }
            ];

            container.innerHTML = items.map(item => `
                <div class="flex justify-between items-center p-3 bg-crooks-black rounded-lg">
                    <span class="font-medium text-gray-300">${item.label}</span>
                    <span class="text-white text-sm">${item.value}</span>
                </div>
            `).join('');
        }

        function displayTrendingHashtags(hashtags) {
            const container = document.getElementById('trendingHashtags');
            if (!hashtags || hashtags.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-4 w-full">No trending hashtags available</div>';
                return;
            }

            container.innerHTML = hashtags.map(tag => `
                <span class="bg-crooks-orange text-crooks-black px-3 py-1 rounded-full text-sm font-medium hover:bg-orange-600 transition-colors cursor-pointer">
                    ${tag.hashtag || tag} ${tag.count ? `(${tag.count})` : ''}
                </span>
            `).join('');
        }

        async function loadIntelligenceData() {
            try {
                console.log('Loading intelligence data...');
                const response = await fetch('/intelligence/report', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Intelligence data loaded:', data);

                // Update competitor rankings
                displayCompetitorRankings(data.competitor_rankings || []);

                // Update strategic insights
                displayStrategicInsights(data.strategic_insights || []);

                // Update content opportunities
                displayContentOpportunities(data.content_opportunities || []);

                dataLoaded.intelligence = true;
                updateLastUpdated();

            } catch (error) {
                console.error('Error loading intelligence data:', error);
                showErrorMessage('intelligence', 'Failed to load intelligence data: ' + error.message);
            }
        }

        function displayCompetitorRankings(rankings) {
            const container = document.getElementById('competitorRankings');
            if (!rankings || rankings.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-4">No competitor data available</div>';
                return;
            }

            container.innerHTML = rankings.map((competitor, index) => `
                <div class="flex justify-between items-center p-3 bg-crooks-black rounded-lg">
                    <div class="flex items-center space-x-3">
                        <span class="text-crooks-orange font-bold">#${index + 1}</span>
                        <span class="font-medium">${competitor.brand || competitor.name}</span>
                        <span class="text-sm text-gray-400">${competitor.momentum || ''}</span>
                    </div>
                    <div class="text-right">
                        <div class="text-white font-bold">${competitor.posts || competitor.score || 0}</div>
                        <div class="text-xs text-gray-400">${competitor.engagement || 'posts'}</div>
                    </div>
                </div>
            `).join('');
        }

        function displayStrategicInsights(insights) {
            const container = document.getElementById('strategicInsights');
            if (!insights || insights.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-4">No strategic insights available</div>';
                return;
            }

            container.innerHTML = insights.map(insight => `
                <div class="p-3 bg-crooks-black rounded-lg border-l-4 border-crooks-orange">
                    <div class="font-medium text-white">${insight.title || insight}</div>
                    ${insight.description ? `<div class="text-sm text-gray-400 mt-1">${insight.description}</div>` : ''}
                </div>
            `).join('');
        }

        function displayContentOpportunities(opportunities) {
            const container = document.getElementById('contentOpportunities');
            if (!opportunities || opportunities.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-4 col-span-full">No content opportunities available</div>';
                return;
            }

            container.innerHTML = opportunities.map(opportunity => `
                <div class="bg-crooks-black p-4 rounded-lg border border-crooks-orange/30">
                    <div class="font-bold text-crooks-orange mb-2">${opportunity.title || opportunity.type}</div>
                    <div class="text-sm text-gray-300 mb-2">${opportunity.description || opportunity}</div>
                    <div class="text-xs text-gray-400">Impact: ${opportunity.impact || 'Medium'}</div>
                </div>
            `).join('');
        }

        async function loadRevenueIntelligence() {
            try {
                console.log('Loading revenue intelligence...');
                const response = await fetch('/shopify/revenue');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Revenue intelligence loaded:', data);

                if (data.success && data.revenue_intelligence) {
                    const ri = data.revenue_intelligence;
                    
                    // Update revenue metrics
                    displayRevenueMetrics(ri.sales_performance || {});
                    
                    // Update conversion funnel
                    displayConversionFunnel(ri.conversion_performance || {});
                    
                    // Update social ROI
                    displaySocialROI(ri.social_media_correlation || {});
                    
                    // Update revenue correlation
                    displayRevenueCorrelation(ri.social_media_correlation || {});
                    
                    // Update optimization opportunities
                    displayOptimizationOpportunities(ri.optimization_opportunities || []);
                } else {
                    throw new Error(data.error || 'No revenue data available');
                }

                dataLoaded.revenue = true;
                updateLastUpdated();

            } catch (error) {
                console.error('Error loading revenue intelligence:', error);
                showErrorMessage('revenue', 'Failed to load revenue data: ' + error.message);
            }
        }

        function displayRevenueMetrics(metrics) {
            const container = document.getElementById('revenueMetrics');
            container.innerHTML = `
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-gray-400">Total Revenue</span>
                        <span class="text-white font-bold">$${(metrics.total_revenue || 0).toLocaleString()}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Total Orders</span>
                        <span class="text-white font-bold">${(metrics.total_orders || 0).toLocaleString()}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Average Order Value</span>
                        <span class="text-white font-bold">$${(metrics.average_order_value || 0).toFixed(2)}</span>
                    </div>
                </div>
            `;
        }

        function displayConversionFunnel(conversion) {
            const container = document.getElementById('conversionFunnel');
            container.innerHTML = `
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-gray-400">Conversion Rate</span>
                        <span class="text-white font-bold">${(conversion.conversion_rate || 0).toFixed(2)}%</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Revenue per Session</span>
                        <span class="text-white font-bold">$${(conversion.revenue_per_session || 0).toFixed(2)}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Estimated Sessions</span>
                        <span class="text-white font-bold">${(conversion.estimated_sessions || 0).toLocaleString()}</span>
                    </div>
                </div>
            `;
        }

        function displaySocialROI(correlation) {
            const container = document.getElementById('socialROI');
            const platforms = Object.keys(correlation);
            
            if (platforms.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-4">No social ROI data available</div>';
                return;
            }

            container.innerHTML = platforms.map(platform => `
                <div class="p-3 bg-crooks-black rounded-lg">
                    <div class="font-bold text-crooks-orange capitalize">${platform}</div>
                    <div class="text-sm text-gray-300">Revenue Correlation: ${correlation[platform].revenue_correlation || 0}%</div>
                    <div class="text-sm text-gray-300">Conversion Rate: ${correlation[platform].conversion_rate || 0}%</div>
                </div>
            `).join('');
        }

        function displayRevenueCorrelation(correlation) {
            const container = document.getElementById('revenueCorrelation');
            const platforms = Object.keys(correlation);
            
            container.innerHTML = platforms.map(platform => `
                <div class="flex justify-between items-center p-3 bg-crooks-black rounded-lg">
                    <span class="capitalize font-medium">${platform}</span>
                    <span class="text-crooks-orange font-bold">$${(correlation[platform].revenue_per_post || 0).toFixed(2)}/post</span>
                </div>
            `).join('');
        }

        function displayOptimizationOpportunities(opportunities) {
            const container = document.getElementById('optimizationOpportunities');
            if (!opportunities || opportunities.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-4">No optimization opportunities available</div>';
                return;
            }

            container.innerHTML = opportunities.map(opportunity => `
                <div class="p-3 bg-crooks-black rounded-lg border-l-4 border-crooks-orange">
                    <div class="text-white">${opportunity}</div>
                </div>
            `).join('');
        }

        async function syncShopifyData(type) {
            try {
                console.log(`Syncing ${type} data...`);
                const response = await fetch(`/shopify/sync/${type}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log(`${type} sync result:`, data);

                if (data.success) {
                    alert(`${type} data synced successfully!`);
                    // Refresh revenue intelligence
                    dataLoaded.revenue = false;
                    if (currentTab === 'revenue') {
                        loadRevenueIntelligence();
                    }
                } else {
                    throw new Error(data.error || 'Sync failed');
                }

            } catch (error) {
                console.error(`Error syncing ${type} data:`, error);
                alert(`Failed to sync ${type} data: ${error.message}`);
            }
        }

        async function loadCalendarData() {
            try {
                console.log('Loading calendar data...');
                const response = await fetch('/calendar/overview');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Calendar data loaded:', data);

                dataLoaded.calendar = true;
                updateLastUpdated();

            } catch (error) {
                console.error('Error loading calendar data:', error);
                showErrorMessage('calendar', 'Failed to load calendar data: ' + error.message);
            }
        }

        async function loadCalendarView(timeframe) {
            try {
                console.log(`Loading ${timeframe} calendar view...`);
                const response = await fetch(`/calendar/${timeframe}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log(`${timeframe} calendar data:`, data);

                const container = document.getElementById('calendarContent');
                container.innerHTML = `
                    <h3 class="text-lg font-bold text-crooks-orange mb-4">üìÖ ${timeframe.charAt(0).toUpperCase() + timeframe.slice(1)} Strategic View</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        ${(data.calendar_items || []).map(item => `
                            <div class="bg-crooks-black p-4 rounded-lg border border-crooks-orange/30">
                                <div class="font-bold text-crooks-orange">${item.date || 'TBD'}</div>
                                <div class="text-white font-medium">${item.title || item.event}</div>
                                <div class="text-sm text-gray-400">${item.description || item.type}</div>
                                ${item.priority ? `<div class="text-xs text-crooks-orange mt-2">Priority: ${item.priority}</div>` : ''}
                            </div>
                        `).join('')}
                    </div>
                `;

            } catch (error) {
                console.error(`Error loading ${timeframe} calendar:`, error);
                document.getElementById('calendarContent').innerHTML = `
                    <div class="text-center text-red-400 py-8">Failed to load ${timeframe} calendar: ${error.message}</div>
                `;
            }
        }

        async function generateContent(type) {
            try {
                console.log(`Generating ${type} content...`);
                const response = await fetch(`/calendar/generate/${type}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log(`${type} generation result:`, data);

                const container = document.getElementById('calendarContent');
                container.innerHTML = `
                    <h3 class="text-lg font-bold text-crooks-orange mb-4">üé® Generated ${type.charAt(0).toUpperCase() + type.slice(1)} Content</h3>
                    <div class="bg-crooks-black p-6 rounded-lg border border-crooks-orange/30">
                        <pre class="text-white whitespace-pre-wrap">${data.generated_content || JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;

                alert(`${type} content generated successfully!`);

            } catch (error) {
                console.error(`Error generating ${type} content:`, error);
                alert(`Failed to generate ${type} content: ${error.message}`);
            }
        }

        async function loadAssetLibrary() {
            try {
                console.log('Loading asset library...');
                const response = await fetch('/ingest/assets');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Asset library loaded:', data);

                if (data.success) {
                    // Update statistics
                    document.getElementById('totalFiles').textContent = data.statistics?.total_files || 0;
                    document.getElementById('totalSize').textContent = (data.statistics?.total_size_mb || 0).toFixed(2) + ' MB';
                    document.getElementById('totalRecords').textContent = data.statistics?.total_records || 0;

                    // Display assets
                    displayAssetLibrary(data.assets || []);
                } else {
                    throw new Error(data.error || 'Failed to load assets');
                }

                dataLoaded.assets = true;
                updateLastUpdated();

            } catch (error) {
                console.error('Error loading asset library:', error);
                showErrorMessage('assets', 'Failed to load asset library: ' + error.message);
            }
        }

        function displayAssetLibrary(assets) {
            const container = document.getElementById('assetLibrary');
            if (!assets || assets.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-8">No assets uploaded yet</div>';
                return;
            }

            container.innerHTML = assets.map(asset => `
                <div class="flex justify-between items-center p-4 bg-crooks-black rounded-lg border border-crooks-orange/30">
                    <div class="flex items-center space-x-4">
                        <div class="text-2xl">
                            ${asset.file_type === 'data' ? 'üìä' : 
                              asset.file_type === 'image' ? 'üñºÔ∏è' : 
                              asset.file_type === 'video' ? 'üé•' : 
                              asset.file_type === 'document' ? 'üìÑ' : 'üìÅ'}
                        </div>
                        <div>
                            <div class="font-medium text-white">${asset.filename}</div>
                            <div class="text-sm text-gray-400">
                                ${asset.file_size_mb} MB
                                ${asset.record_count > 0 ? ` ‚Ä¢ ${asset.record_count} records` : ''}
                                ‚Ä¢ ${new Date(asset.upload_date).toLocaleDateString()}
                            </div>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        ${asset.downloadable ? `<button onclick="downloadAsset('${asset.filename}')" class="text-crooks-orange hover:text-orange-400 transition-colors">üì•</button>` : ''}
                        ${asset.deletable ? `<button onclick="deleteAsset('${asset.filename}')" class="text-red-400 hover:text-red-300 transition-colors">üóëÔ∏è</button>` : ''}
                    </div>
                </div>
            `).join('');
        }

        async function deleteAsset(filename) {
            if (!confirm(`Are you sure you want to delete "${filename}"?`)) {
                return;
            }

            try {
                console.log(`Deleting asset: ${filename}`);
                const response = await fetch(`/ingest/assets/${encodeURIComponent(filename)}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Delete result:', data);

                if (data.success) {
                    alert('Asset deleted successfully!');
                    // Refresh asset library
                    loadAssetLibrary();
                    // Refresh overview data since data changed
                    dataLoaded.overview = false;
                    if (currentTab === 'overview') {
                        loadOverviewData();
                    }
                } else {
                    throw new Error(data.error || 'Delete failed');
                }

            } catch (error) {
                console.error('Error deleting asset:', error);
                alert(`Failed to delete asset: ${error.message}`);
            }
        }

        async function loadAgencyData() {
            try {
                console.log('Loading agency data...');
                const response = await fetch('/agency/overview');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Agency data loaded:', data);

                // Display HVD partnership data
                displayHVDPartnership(data.hvd_partnership || {});

                // Display agency metrics
                displayAgencyMetrics(data.performance_metrics || {});

                // Display deliverables tracking
                displayDeliverablesTracking(data.deliverables || []);

                // Display strategic goals
                displayStrategicGoals(data.strategic_goals || []);

                dataLoaded.agency = true;
                updateLastUpdated();

            } catch (error) {
                console.error('Error loading agency data:', error);
                showErrorMessage('agency', 'Failed to load agency data: ' + error.message);
            }
        }

        function displayHVDPartnership(partnership) {
            const container = document.getElementById('hvdPartnership');
            container.innerHTML = `
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">Current Phase</span>
                        <span class="text-crooks-orange font-bold">${partnership.current_phase || 'Phase 1'}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">Investment Level</span>
                        <span class="text-white font-bold">$${(partnership.investment_level || 4000).toLocaleString()}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">Partnership Status</span>
                        <span class="text-green-400 font-bold">${partnership.status || 'Active'}</span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-2">
                        <div class="bg-crooks-orange h-2 rounded-full transition-all duration-500" style="width: ${partnership.progress || 35}%"></div>
                    </div>
                    <div class="text-sm text-gray-400">Progress: ${partnership.progress || 35}% Complete</div>
                </div>
            `;
        }

        function displayAgencyMetrics(metrics) {
            const container = document.getElementById('agencyMetrics');
            container.innerHTML = `
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-gray-400">Deliverables Completed</span>
                        <span class="text-white font-bold">${metrics.deliverables_completed || 0}/${metrics.total_deliverables || 0}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">On-Time Delivery</span>
                        <span class="text-green-400 font-bold">${metrics.on_time_percentage || 0}%</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Quality Score</span>
                        <span class="text-crooks-orange font-bold">${metrics.quality_score || 0}/10</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Client Satisfaction</span>
                        <span class="text-blue-400 font-bold">${metrics.satisfaction_score || 0}/10</span>
                    </div>
                </div>
            `;
        }

        function displayDeliverablesTracking(deliverables) {
            const container = document.getElementById('deliverablesTracking');
            if (!deliverables || deliverables.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-4">No deliverables tracked</div>';
                return;
            }

            container.innerHTML = deliverables.map(deliverable => `
                <div class="flex justify-between items-center p-3 bg-crooks-black rounded-lg">
                    <div>
                        <div class="font-medium text-white">${deliverable.title}</div>
                        <div class="text-sm text-gray-400">Due: ${deliverable.due_date}</div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm font-bold ${deliverable.status === 'completed' ? 'text-green-400' : 
                                                        deliverable.status === 'in_progress' ? 'text-yellow-400' : 
                                                        'text-gray-400'}">${deliverable.status}</div>
                    </div>
                </div>
            `).join('');
        }

        function displayStrategicGoals(goals) {
            const container = document.getElementById('strategicGoals');
            if (!goals || goals.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-4">No strategic goals defined</div>';
                return;
            }

            container.innerHTML = goals.map(goal => `
                <div class="p-3 bg-crooks-black rounded-lg border-l-4 border-crooks-orange">
                    <div class="font-medium text-white">${goal.title}</div>
                    <div class="text-sm text-gray-400 mt-1">${goal.description}</div>
                    <div class="flex justify-between items-center mt-2">
                        <span class="text-xs text-gray-500">Target: ${goal.target_date}</span>
                        <span class="text-xs text-crooks-orange">${goal.progress || 0}% Complete</span>
                    </div>
                </div>
            `).join('');
        }

        function setupFileUpload() {
            const fileInput = document.getElementById('fileInput');
            fileInput.addEventListener('change', handleFileUpload);
        }

        function setupAssetFileUpload() {
            const assetFileInput = document.getElementById('assetFileInput');
            assetFileInput.addEventListener('change', handleAssetFileUpload);
        }

        async function handleFileUpload(event) {
            const files = event.target.files;
            if (!files || files.length === 0) return;

            for (const file of files) {
                await uploadFile(file);
            }

            // Clear the input
            event.target.value = '';
        }

        async function handleAssetFileUpload(event) {
            const files = event.target.files;
            if (!files || files.length === 0) return;

            for (const file of files) {
                await uploadFile(file, 'asset_upload');
            }

            // Clear the input and refresh asset library
            event.target.value = '';
            loadAssetLibrary();
        }

        async function uploadFile(file, source = 'manual_upload') {
            try {
                console.log(`Uploading file: ${file.name}`);
                
                const formData = new FormData();
                formData.append('file', file);
                formData.append('source', source);

                const response = await fetch('/ingest/upload', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('Upload result:', data);

                if (data.success) {
                    alert(`File "${file.name}" uploaded successfully! Processed ${data.processing_results?.total_records || 0} records.`);
                    
                    // Update processing status
                    updateProcessingStatus(data.run_record);
                    
                    // Refresh data if needed
                    if (data.data_refresh_triggered) {
                        dataLoaded.overview = false;
                        dataLoaded.intelligence = false;
                        if (currentTab === 'overview') {
                            loadOverviewData();
                        }
                    }
                } else {
                    throw new Error(data.error || 'Upload failed');
                }

            } catch (error) {
                console.error('Error uploading file:', error);
                alert(`Failed to upload "${file.name}": ${error.message}`);
            }
        }

        async function processJsonPaste() {
            const textarea = document.getElementById('jsonPasteArea');
            const jsonData = textarea.value.trim();

            if (!jsonData) {
                alert('Please paste JSON data first');
                return;
            }

            try {
                console.log('Processing pasted JSON data...');
                
                const response = await fetch('/ingest/paste', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        data: jsonData,
                        source: 'json_paste',
                        data_type: 'json'
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('Paste processing result:', data);

                if (data.success) {
                    alert(`JSON data processed successfully! Processed ${data.processing_results?.total_records || 0} records.`);
                    
                    // Clear the textarea
                    textarea.value = '';
                    
                    // Update processing status
                    updateProcessingStatus(data.run_record);
                    
                    // Refresh data if needed
                    if (data.data_refresh_triggered) {
                        dataLoaded.overview = false;
                        dataLoaded.intelligence = false;
                        if (currentTab === 'overview') {
                            loadOverviewData();
                        }
                    }
                } else {
                    throw new Error(data.error || 'Processing failed');
                }

            } catch (error) {
                console.error('Error processing JSON paste:', error);
                alert(`Failed to process JSON data: ${error.message}`);
            }
        }

        function updateProcessingStatus(runRecord) {
            const container = document.getElementById('processingStatus');
            if (!runRecord) return;

            const statusHtml = `
                <div class="p-3 bg-crooks-black rounded-lg border border-crooks-orange/30">
                    <div class="flex justify-between items-center">
                        <span class="font-medium text-white">${runRecord.source}</span>
                        <span class="text-sm text-green-400">${runRecord.status}</span>
                    </div>
                    <div class="text-sm text-gray-400 mt-1">
                        ${runRecord.records_processed} records processed
                    </div>
                    <div class="text-xs text-gray-500 mt-1">
                        ${new Date(runRecord.timestamp).toLocaleString()}
                    </div>
                </div>
            `;

            container.innerHTML = statusHtml;
        }

        async function checkSystemHealth() {
            try {
                const response = await fetch('/ingest/health');
                const data = await response.json();
                
                const container = document.getElementById('systemHealth');
                container.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 ${data.status === 'healthy' ? 'bg-green-500' : 'bg-red-500'} rounded-full"></div>
                        <span class="text-white">${data.message || data.status}</span>
                    </div>
                `;

            } catch (error) {
                console.error('Error checking system health:', error);
                const container = document.getElementById('systemHealth');
                container.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                        <span class="text-red-400">System health check failed</span>
                    </div>
                `;
            }
        }

        async function checkShopifyStatus() {
            try {
                const response = await fetch('/shopify/status');
                const data = await response.json();
                
                const statusElement = document.getElementById('shopifyStatus');
                const isConnected = data.connected;
                
                statusElement.innerHTML = `
                    <div class="w-3 h-3 ${isConnected ? 'bg-green-500' : 'bg-red-500'} rounded-full"></div>
                    <span class="text-sm text-gray-300">Shopify: ${isConnected ? 'Connected' : 'Not Connected'}</span>
                `;

            } catch (error) {
                console.error('Error checking Shopify status:', error);
                const statusElement = document.getElementById('shopifyStatus');
                statusElement.innerHTML = `
                    <div class="w-3 h-3 bg-gray-500 rounded-full"></div>
                    <span class="text-sm text-gray-300">Shopify: Error</span>
                `;
            }
        }

        async function testShopifyConnection() {
            const shopUrl = document.getElementById('shopUrl').value.trim();
            const accessToken = document.getElementById('accessToken').value.trim();

            if (!shopUrl || !accessToken) {
                alert('Please enter both shop URL and access token');
                return;
            }

            try {
                console.log('Testing Shopify connection...');
                
                const response = await fetch('/shopify/connect', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        shop_url: shopUrl,
                        access_token: accessToken,
                        api_version: '2023-10'
                    })
                });

                const data = await response.json();
                console.log('Connection test result:', data);

                const statusContainer = document.getElementById('shopifyConnectionStatus');
                
                if (data.success) {
                    statusContainer.innerHTML = `
                        <div class="flex items-center space-x-3">
                            <div class="w-4 h-4 bg-green-500 rounded-full"></div>
                            <span class="text-green-400">Connected to ${data.shop_info?.name || shopUrl}</span>
                        </div>
                    `;
                    alert('Connection successful!');
                } else {
                    statusContainer.innerHTML = `
                        <div class="flex items-center space-x-3">
                            <div class="w-4 h-4 bg-red-500 rounded-full"></div>
                            <span class="text-red-400">Connection failed: ${data.error}</span>
                        </div>
                    `;
                    alert(`Connection failed: ${data.error}`);
                }

            } catch (error) {
                console.error('Error testing Shopify connection:', error);
                alert(`Connection test failed: ${error.message}`);
            }
        }

        async function saveShopifyConfig() {
            const shopUrl = document.getElementById('shopUrl').value.trim();
            const accessToken = document.getElementById('accessToken').value.trim();

            if (!shopUrl || !accessToken) {
                alert('Please enter both shop URL and access token');
                return;
            }

            try {
                console.log('Saving Shopify configuration...');
                
                const response = await fetch('/shopify/connect', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        shop_url: shopUrl,
                        access_token: accessToken,
                        api_version: '2023-10'
                    })
                });

                const data = await response.json();
                console.log('Save config result:', data);

                if (data.success) {
                    alert('Shopify configuration saved successfully!');
                    checkShopifyStatus(); // Refresh status
                } else {
                    alert(`Failed to save configuration: ${data.error}`);
                }

            } catch (error) {
                console.error('Error saving Shopify configuration:', error);
                alert(`Failed to save configuration: ${error.message}`);
            }
        }

        function showErrorMessage(section, message) {
            console.error(`Error in ${section}:`, message);
            // You could implement a more sophisticated error display here
        }

        // Auto-refresh data every 5 minutes
        setInterval(() => {
            if (currentTab === 'overview' && dataLoaded.overview) {
                loadOverviewData();
            }
        }, 300000);
    </script>
</body>
</html>
