<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crooks & Castles Command Center V2</title>
    <style>
        /* Tailwind CSS Reset and Base Styles */
        *, ::before, ::after {
            box-sizing: border-box;
            border-width: 0;
            border-style: solid;
            border-color: #e5e7eb;
        }
        
        html {
            line-height: 1.5;
            -webkit-text-size-adjust: 100%;
            -moz-tab-size: 4;
            tab-size: 4;
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
        }
        
        body {
            margin: 0;
            line-height: inherit;
        }
        
        /* Custom Crooks & Castles Styles */
        :root {
            --crooks-black: #0a0a0a;
            --crooks-orange: #ff6b35;
            --crooks-gold: #ffd700;
            --crooks-gray: #1a1a1a;
        }
        
        body {
            background-color: var(--crooks-black);
            color: white;
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }
        
        .header {
            background-color: var(--crooks-gray);
            border-bottom: 1px solid rgba(255, 107, 53, 0.3);
            padding: 1rem 0;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--crooks-orange);
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .status-online { background-color: #10b981; }
        .status-offline { background-color: #ef4444; }
        .status-checking { background-color: #6b7280; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .nav {
            background-color: var(--crooks-gray);
            border-bottom: 1px solid rgba(255, 107, 53, 0.3);
        }
        
        .nav-tabs {
            display: flex;
            gap: 0.25rem;
            flex-wrap: wrap;
        }
        
        .tab-button {
            padding: 0.75rem 1.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: 0.5rem 0.5rem 0 0;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            background: transparent;
            color: #9ca3af;
        }
        
        .tab-button:hover {
            color: white;
        }
        
        .tab-active {
            background: linear-gradient(45deg, var(--crooks-orange), var(--crooks-gold));
            color: var(--crooks-black);
            font-weight: bold;
        }
        
        .main-content {
            padding: 1.5rem 0;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .grid {
            display: grid;
            gap: 1.5rem;
        }
        
        .grid-cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .grid-cols-2 {
            grid-template-columns: repeat(2, 1fr);
        }
        
        @media (max-width: 1024px) {
            .grid-cols-3, .grid-cols-2 {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background-color: var(--crooks-gray);
            padding: 1.5rem;
            border-radius: 0.5rem;
            border: 1px solid rgba(255, 107, 53, 0.3);
        }
        
        .card-title {
            font-size: 1.125rem;
            font-weight: bold;
            color: var(--crooks-orange);
            margin-bottom: 1rem;
        }
        
        .metric-value {
            font-size: 1.875rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .metric-label {
            font-size: 0.875rem;
            color: #9ca3af;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary {
            background-color: var(--crooks-orange);
            color: var(--crooks-black);
        }
        
        .btn-primary:hover {
            background-color: #e55a2b;
        }
        
        .btn-secondary {
            background-color: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #4b5563;
        }
        
        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #d1d5db;
            margin-bottom: 0.5rem;
        }
        
        .form-input {
            width: 100%;
            background-color: var(--crooks-black);
            border: 1px solid rgba(255, 107, 53, 0.3);
            border-radius: 0.5rem;
            padding: 0.75rem;
            color: white;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--crooks-orange);
        }
        
        .upload-area {
            border: 2px dashed rgba(255, 107, 53, 0.5);
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: var(--crooks-orange);
        }
        
        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .media-item {
            background-color: var(--crooks-black);
            border-radius: 0.5rem;
            border: 1px solid rgba(255, 107, 53, 0.3);
            overflow: hidden;
        }
        
        .media-item-content {
            padding: 1rem;
        }
        
        .media-item-actions {
            display: flex;
            gap: 0.5rem;
            padding: 0.5rem;
            background-color: var(--crooks-gray);
        }
        
        .text-center {
            text-align: center;
        }
        
        .text-sm {
            font-size: 0.875rem;
        }
        
        .text-xs {
            font-size: 0.75rem;
        }
        
        .text-gray-400 {
            color: #9ca3af;
        }
        
        .text-red-400 {
            color: #f87171;
        }
        
        .text-green-400 {
            color: #4ade80;
        }
        
        .mb-4 {
            margin-bottom: 1rem;
        }
        
        .mb-6 {
            margin-bottom: 1.5rem;
        }
        
        .mt-2 {
            margin-top: 0.5rem;
        }
        
        .mt-4 {
            margin-top: 1rem;
        }
        
        .py-8 {
            padding-top: 2rem;
            padding-bottom: 2rem;
        }
        
        .hidden {
            display: none;
        }
        
        .loading-spinner {
            border: 2px solid var(--crooks-gray);
            border-top: 2px solid var(--crooks-orange);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Calendar Specific Styles */
        .calendar-view-content {
            margin-top: 1rem;
        }
        
        .calendar-container {
            background-color: var(--crooks-gray);
            border-radius: 0.5rem;
            border: 1px solid rgba(255, 107, 53, 0.3);
            overflow: hidden;
        }

        .calendar-header {
            background: linear-gradient(45deg, var(--crooks-orange), var(--crooks-gold));
            color: var(--crooks-black);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .calendar-nav-btn {
            background: rgba(0, 0, 0, 0.2);
            border: none;
            color: var(--crooks-black);
            padding: 0.5rem;
            border-radius: 0.25rem;
            cursor: pointer;
            font-weight: bold;
        }

        .calendar-nav-btn:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        .event-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .event-modal-content {
            background-color: var(--crooks-gray);
            border-radius: 0.5rem;
            border: 1px solid rgba(255, 107, 53, 0.3);
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: #9ca3af;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .modal-close:hover {
            color: white;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <h1 class="header-title">üëë Crooks & Castles Command Center V2</h1>
                    <div id="systemStatus" class="status-indicator">
                        <div class="status-dot status-online"></div>
                        <span class="text-sm text-gray-400">System Online</span>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div id="shopifyStatus" class="status-indicator">
                        <div class="status-dot status-checking"></div>
                        <span class="text-sm text-gray-400">Shopify: Checking...</span>
                    </div>
                    <div class="text-sm text-gray-400">
                        Last Updated: <span id="lastUpdated">Loading...</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="nav">
        <div class="container">
            <div class="nav-tabs">
                <button onclick="showTab('overview')" id="tab-overview" class="tab-button tab-active">
                    üìä Executive Overview
                </button>
                <button onclick="showTab('intelligence')" id="tab-intelligence" class="tab-button">
                    üß† Intelligence
                </button>
                <button onclick="showTab('revenue')" id="tab-revenue" class="tab-button">
                    üí∞ Revenue Intelligence
                </button>
                <button onclick="showTab('calendar')" id="tab-calendar" class="tab-button">
                    üìÖ Campaign Calendar
                </button>
                <button onclick="showTab('media')" id="tab-media" class="tab-button">
                    üé¨ Media Library
                </button>
                <button onclick="showTab('ingest')" id="tab-ingest" class="tab-button">
                    üì• Data Ingest
                </button>
                <button onclick="showTab('shopify-setup')" id="tab-shopify-setup" class="tab-button">
                    üõí Shopify Setup
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Executive Overview Tab -->
            <div id="overview-tab" class="tab-content active">
                <div class="grid grid-cols-3 mb-6">
                    <div class="card">
                        <h3 class="card-title">üìä Total Posts</h3>
                        <div class="metric-value" id="totalPosts">557</div>
                        <div class="metric-label">Competitive intelligence data</div>
                    </div>
                    <div class="card">
                        <h3 class="card-title">üè¢ Brands Tracked</h3>
                        <div class="metric-value" id="brandsTracked">--</div>
                        <div class="metric-label">Competitor brands monitored</div>
                    </div>
                    <div class="card">
                        <h3 class="card-title">üí∞ Revenue Impact</h3>
                        <div class="metric-value" id="revenueImpact">--</div>
                        <div class="metric-label">Shopify integration required</div>
                    </div>
                </div>

                <div class="grid grid-cols-2">
                    <div class="card">
                        <h3 class="card-title">üìà Performance Summary</h3>
                        <div id="performanceSummary">
                            <div class="text-center text-gray-400 py-8">Loading performance data...</div>
                        </div>
                    </div>

                    <div class="card">
                        <h3 class="card-title">üéØ Key Insights</h3>
                        <div id="keyInsights">
                            <div class="text-center text-gray-400 py-8">Loading insights...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Intelligence Tab -->
            <div id="intelligence-tab" class="tab-content">
                <div class="grid grid-cols-2 mb-6">
                    <div class="card">
                        <h3 class="card-title">üîç Competitive Analysis</h3>
                        <div id="competitiveAnalysis">
                            <div class="text-center text-gray-400 py-8">Loading competitive analysis...</div>
                        </div>
                    </div>

                    <div class="card">
                        <h3 class="card-title">üìä Market Trends</h3>
                        <div id="marketTrends">
                            <div class="text-center text-gray-400 py-8">Loading market trends...</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">üéØ Strategic Recommendations</h3>
                    <div id="strategicRecommendations">
                        <div class="text-center text-gray-400 py-8">Loading recommendations...</div>
                    </div>
                </div>
            </div>

            <!-- Revenue Intelligence Tab -->
            <div id="revenue-tab" class="tab-content">
                <div class="grid grid-cols-3 mb-6">
                    <div class="card">
                        <h3 class="card-title">üí∞ Revenue Metrics</h3>
                        <div id="revenueMetrics">
                            <div class="text-center text-gray-400 py-8">Connect Shopify to view revenue data</div>
                        </div>
                    </div>

                    <div class="card">
                        <h3 class="card-title">üìà Conversion Funnel</h3>
                        <div id="conversionFunnel">
                            <div class="text-center text-gray-400 py-8">Connect Shopify to view conversion data</div>
                        </div>
                    </div>

                    <div class="card">
                        <h3 class="card-title">üéØ Social ROI</h3>
                        <div id="socialROI">
                            <div class="text-center text-gray-400 py-8">Connect Shopify to view ROI data</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">üîÑ Sync Shopify Data</h3>
                    <div style="display: flex; gap: 1rem;">
                        <button onclick="syncShopifyData('sales')" class="btn btn-primary">
                            üí∞ Sync Sales
                        </button>
                        <button onclick="syncShopifyData('traffic')" class="btn btn-primary">
                            üìä Sync Traffic
                        </button>
                        <button onclick="syncShopifyData('products')" class="btn btn-primary">
                            üõçÔ∏è Sync Products
                        </button>
                    </div>
                </div>
            </div>

            <!-- Campaign Calendar Tab -->
            <div id="calendar-tab" class="tab-content">
                <!-- Strategic Calendar Views -->
                <div class="card mb-6">
                    <h3 class="card-title">üìä Strategic Calendar Views</h3>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button onclick="switchCalendarView('tactical7')" id="view-tactical7" class="btn btn-secondary btn-small">
                            üìÖ 7-Day Tactical
                        </button>
                        <button onclick="switchCalendarView('strategic30')" id="view-strategic30" class="btn btn-secondary btn-small">
                            üéØ 30-Day Strategic  
                        </button>
                        <button onclick="switchCalendarView('strategic60')" id="view-strategic60" class="btn btn-secondary btn-small">
                            üåü 60-Day Planning
                        </button>
                        <button onclick="switchCalendarView('strategic90')" id="view-strategic90" class="btn btn-secondary btn-small">
                            üöÄ 90+ Long-term
                        </button>
                        <button onclick="openQuarterlyStrategy()" class="btn btn-primary btn-small">
                            üìã Quarterly Strategy
                        </button>
                    </div>
                </div>

                <!-- Content Creation Tools -->
                <div class="card mb-6">
                    <h3 class="card-title">üé® Content Creation Tools</h3>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button onclick="generateCampaign()" class="btn btn-primary btn-small">
                            üéØ Campaign Generator
                        </button>
                        <button onclick="analyzeTrends()" class="btn btn-primary btn-small">
                            üìà Trend Analysis
                        </button>
                        <button onclick="createContentCalendar()" class="btn btn-primary btn-small">
                            üìÖ Content Calendar Creator
                        </button>
                        <button onclick="planCulturalMoments()" class="btn btn-primary btn-small">
                            üåç Cultural Moment Planner
                        </button>
                    </div>
                </div>

                <!-- 7-Day Tactical View -->
                <div id="tactical7-view" class="calendar-view-content">
                    <div class="grid grid-cols-2">
                        <div class="card">
                            <h3 class="card-title">üìã Weekly Content Pipeline</h3>
                            <div id="weeklyPipeline">
                                <div class="text-center text-gray-400 py-8">Loading weekly content...</div>
                            </div>
                        </div>
                        <div class="card">
                            <h3 class="card-title">üé¨ Asset Mapping</h3>
                            <div id="assetMapping">
                                <div class="text-center text-gray-400 py-8">Loading asset assignments...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 30-Day Strategic View -->
                <div id="strategic30-view" class="calendar-view-content hidden">
                    <div class="grid grid-cols-2">
                        <div class="card">
                            <h3 class="card-title">‚úÖ Approved Content</h3>
                            <div id="approvedContent">
                                <div class="text-center text-gray-400 py-8">Loading approved content...</div>
                            </div>
                        </div>
                        <div class="card">
                            <h3 class="card-title">üí° Opportunities</h3>
                            <div id="contentOpportunities">
                                <div class="text-center text-gray-400 py-8">Loading opportunities...</div>
                            </div>
                        </div>
                    </div>
                    <div class="card mt-6">
                        <h3 class="card-title">üìä Completion Tracking</h3>
                        <div id="completionTracking">
                            <div class="text-center text-gray-400 py-8">Loading completion status...</div>
                        </div>
                    </div>
                </div>

                <!-- 60-Day Planning View -->
                <div id="strategic60-view" class="calendar-view-content hidden">
                    <div class="grid grid-cols-2">
                        <div class="card">
                            <h3 class="card-title">üéâ Upcoming Holidays</h3>
                            <div id="upcomingHolidays">
                                <div class="text-center text-gray-400 py-8">Loading holidays...</div>
                            </div>
                        </div>
                        <div class="card">
                            <h3 class="card-title">üéµ Cultural Moments</h3>
                            <div id="culturalMoments">
                                <div class="text-center text-gray-400 py-8">Loading cultural moments...</div>
                            </div>
                        </div>
                    </div>
                    <div class="card mt-6">
                        <h3 class="card-title">üèÜ Campaign Themes</h3>
                        <div id="campaignThemes">
                            <div class="text-center text-gray-400 py-8">Loading campaign themes...</div>
                        </div>
                    </div>
                </div>

                <!-- 90+ Day Long-term View -->
                <div id="strategic90-view" class="calendar-view-content hidden">
                    <div class="grid grid-cols-3">
                        <div class="card">
                            <h3 class="card-title">üéÇ Important Birthdays</h3>
                            <div id="importantBirthdays">
                                <div class="text-center text-gray-400 py-8">Loading birthdays...</div>
                            </div>
                        </div>
                        <div class="card">
                            <h3 class="card-title">üíø Album Drops</h3>
                            <div id="albumDrops">
                                <div class="text-center text-gray-400 py-8">Loading album releases...</div>
                            </div>
                        </div>
                        <div class="card">
                            <h3 class="card-title">üìÖ Anniversaries</h3>
                            <div id="anniversaries">
                                <div class="text-center text-gray-400 py-8">Loading anniversaries...</div>
                            </div>
                        </div>
                    </div>
                    <div class="card mt-6">
                        <h3 class="card-title">üí´ Marketing Opportunities</h3>
                        <div id="marketingOpportunities">
                            <div class="text-center text-gray-400 py-8">Loading opportunities...</div>
                        </div>
                    </div>
                </div>

                <!-- Traditional Calendar View (fallback) -->
                <div id="calendar-traditional-view" class="calendar-view-content hidden">
                    <div class="grid grid-cols-3">
                        <div style="grid-column: 1 / 3;">
                            <div class="calendar-container">
                                <div class="calendar-header">
                                    <button onclick="changeMonth(-1)" class="calendar-nav-btn">‚Äπ</button>
                                    <h3 id="calendarMonth" style="margin: 0; font-size: 1.25rem; font-weight: bold;"></h3>
                                    <button onclick="changeMonth(1)" class="calendar-nav-btn">‚Ä∫</button>
                                </div>
                                <div class="calendar-grid">
                                    <div class="calendar-day-header">Sun</div>
                                    <div class="calendar-day-header">Mon</div>
                                    <div class="calendar-day-header">Tue</div>
                                    <div class="calendar-day-header">Wed</div>
                                    <div class="calendar-day-header">Thu</div>
                                    <div class="calendar-day-header">Fri</div>
                                    <div class="calendar-day-header">Sat</div>
                                    <div id="calendarDays"></div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div class="calendar-sidebar">
                                <h3 class="card-title">üéØ Upcoming Events</h3>
                                <div id="upcomingEvents" class="upcoming-events">
                                    <!-- Events will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Media Library Tab -->
            <div id="media-tab" class="tab-content">
                <div class="grid grid-cols-3 mb-6">
                    <div class="card">
                        <h3 class="card-title">üñºÔ∏è Images</h3>
                        <div class="metric-value" id="totalImages">--</div>
                    </div>
                    <div class="card">
                        <h3 class="card-title">üé• Videos</h3>
                        <div class="metric-value" id="totalVideos">--</div>
                    </div>
                    <div class="card">
                        <h3 class="card-title">üíæ Total Size</h3>
                        <div class="metric-value" id="totalMediaSize">-- MB</div>
                    </div>
                </div>

                <div class="card mb-6">
                    <h3 class="card-title">‚¨ÜÔ∏è Upload Media</h3>
                    <div class="upload-area" onclick="document.getElementById('mediaFileInput').click()">
                        <input type="file" id="mediaFileInput" class="hidden" accept="image/*,video/*,audio/*" multiple>
                        <button class="btn btn-primary">
                            üìÅ Select Media Files
                        </button>
                        <p class="text-gray-400 mt-2">Supports: Images (JPG, PNG, GIF), Videos (MP4, MOV, AVI), Audio (MP3, WAV)</p>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">üìö Media Library</h3>
                    <div id="mediaLibrary" class="media-grid">
                        <div class="text-center text-gray-400 py-8" style="grid-column: 1 / -1;">Loading media library...</div>
                    </div>
                </div>
            </div>

            <!-- Data Ingest Tab -->
            <div id="ingest-tab" class="tab-content">
                <div class="grid grid-cols-2 mb-6">
                    <div class="card">
                        <h3 class="card-title">üìÅ File Upload</h3>
                        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                            <input type="file" id="fileInput" class="hidden" accept=".json,.jsonl,.csv,.txt" multiple>
                            <button class="btn btn-primary mb-4">
                                üìÅ Select Files
                            </button>
                            <p class="text-gray-400 text-sm">Supports: JSON, JSONL, CSV, TXT</p>
                        </div>
                    </div>

                    <div class="card">
                        <h3 class="card-title">üìù JSON Paste</h3>
                        <textarea id="jsonPasteArea" class="form-input" style="height: 8rem; resize: none;" placeholder='Paste JSON data here...'></textarea>
                        <button onclick="processJsonPaste()" class="btn btn-primary mt-4">
                            üöÄ Process JSON
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">üìä Processing Status</h3>
                    <div id="processingStatus">
                        <div class="text-gray-400">No recent processing activity</div>
                    </div>
                </div>
            </div>

            <!-- Shopify Setup Tab -->
            <div id="shopify-setup-tab" class="tab-content">
                <div style="max-width: 42rem; margin: 0 auto;">
                    <div class="card">
                        <h3 style="font-size: 1.5rem; font-weight: bold; color: var(--crooks-orange); margin-bottom: 1.5rem;">üõí Shopify Integration Setup</h3>
                        
                        <div id="shopifyConnectionStatus" class="mb-6" style="padding: 1rem; border-radius: 0.5rem; background-color: var(--crooks-black); border: 1px solid #6b7280;">
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <div style="width: 1rem; height: 1rem; background-color: #6b7280; border-radius: 50%;"></div>
                                <span>Checking connection status...</span>
                            </div>
                        </div>

                        <form id="shopifySetupForm" style="display: flex; flex-direction: column; gap: 1.5rem;">
                            <div class="form-group">
                                <label class="form-label">Shop URL</label>
                                <input type="text" id="shopUrl" class="form-input" placeholder="your-shop.myshopify.com">
                                <p class="text-gray-400 text-sm mt-2">Enter your Shopify store URL (without https://)</p>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Access Token</label>
                                <input type="password" id="accessToken" class="form-input" placeholder="shpat_...">
                                <p class="text-gray-400 text-sm mt-2">Private app access token from your Shopify admin</p>
                            </div>

                            <div style="display: flex; gap: 1rem;">
                                <button type="button" onclick="testShopifyConnection()" class="btn btn-secondary">
                                    üîç Test Connection
                                </button>
                                <button type="button" onclick="saveShopifyConfig()" class="btn btn-primary">
                                    üíæ Save Configuration
                                </button>
                            </div>
                        </form>

                        <div class="mt-4" style="padding: 1rem; background-color: var(--crooks-black); border-radius: 0.5rem; border: 1px solid #6b7280;">
                            <h4 style="font-weight: bold; color: var(--crooks-orange); margin-bottom: 0.5rem;">üìã Setup Instructions:</h4>
                            <ol class="text-sm" style="color: #d1d5db; line-height: 1.5;">
                                <li>1. Go to your Shopify Admin ‚Üí Apps ‚Üí Develop apps</li>
                                <li>2. Create a private app with Admin API access</li>
                                <li>3. Enable permissions for: Orders (read), Products (read), Analytics (read)</li>
                                <li>4. Copy the Admin API access token</li>
                                <li>5. Enter your shop URL and access token above</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Event Modal -->
    <div id="eventModal" class="event-modal">
        <div class="event-modal-content">
            <button onclick="closeEventModal()" class="modal-close">√ó</button>
            <h3 class="card-title">üìÖ Add Calendar Event</h3>
            
            <div class="event-type-selector">
                <button type="button" onclick="setEventType('campaign')" id="type-campaign" class="event-type-btn active">üéØ Campaign</button>
                <button type="button" onclick="setEventType('meeting')" id="type-meeting" class="event-type-btn">üë• Meeting</button>
                <button type="button" onclick="setEventType('deadline')" id="type-deadline" class="event-type-btn">‚ö†Ô∏è Deadline</button>
                <button type="button" onclick="setEventType('content')" id="type-content" class="event-type-btn">üìù Content</button>
            </div>

            <div class="form-group">
                <label class="form-label">Event Title</label>
                <input type="text" id="eventTitle" class="form-input" placeholder="Enter event title...">
            </div>

            <div class="form-group">
                <label class="form-label">Date</label>
                <input type="date" id="eventDate" class="form-input">
            </div>

            <div class="form-group">
                <label class="form-label">Description</label>
                <textarea id="eventDescription" class="form-input" style="height: 4rem; resize: none;" placeholder="Event details..."></textarea>
            </div>

            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                <button onclick="closeEventModal()" class="btn btn-secondary">Cancel</button>
                <button onclick="saveEvent()" class="btn btn-primary">Save Event</button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentTab = 'overview';
        let dataLoaded = {
            overview: false,
            intelligence: false,
            revenue: false,
            media: false,
            ingest: false,
            calendar: false
        };

        // Calendar state
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();
        let selectedDate = null;
        let currentEventType = 'campaign';
        let currentCalendarView = 'tactical7';
        let events = [];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Crooks & Castles Command Center V2 initializing...');
            updateLastUpdated();
            checkShopifyStatus();
            loadOverviewData();
            setupFileUpload();
            setupMediaFileUpload();
            initializeCalendar();
        });

        function updateLastUpdated() {
            document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString();
        }

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('tab-active');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');

            // Add active class to selected tab button
            const activeButton = document.getElementById('tab-' + tabName);
            activeButton.classList.add('tab-active');

            currentTab = tabName;

            // Load data for tab if not already loaded
            if (!dataLoaded[tabName]) {
                switch(tabName) {
                    case 'overview':
                        loadOverviewData();
                        break;
                    case 'intelligence':
                        loadIntelligenceData();
                        break;
                    case 'revenue':
                        loadRevenueIntelligence();
                        break;
                    case 'media':
                        loadMediaLibrary();
                        break;
                    case 'calendar':
                        loadCalendarData();
                        break;
                }
            }
        }

        // Calendar Functions
        function initializeCalendar() {
            renderCalendar();
            updateUpcomingEvents();
        }

        function loadCalendarData() {
            switchCalendarView('tactical7'); // Default to 7-day tactical view
            dataLoaded.calendar = true;
        }

        // Calendar View Switching
        function switchCalendarView(viewType) {
            currentCalendarView = viewType;
            
            // Hide all views
            document.querySelectorAll('.calendar-view-content').forEach(view => {
                view.classList.add('hidden');
            });
            
            // Remove active class from all view buttons
            document.querySelectorAll('[id^="view-"]').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('btn-secondary');
                btn.classList.remove('btn-primary');
            });
            
            // Show selected view and activate button
            document.getElementById(`${viewType}-view`).classList.remove('hidden');
            const activeBtn = document.getElementById(`view-${viewType}`);
            if (activeBtn) {
                activeBtn.classList.add('tab-active');
                activeBtn.classList.remove('btn-secondary');
                activeBtn.classList.add('btn-primary');
            }
            
            // Load data for the selected view
            switch(viewType) {
                case 'tactical7':
                    load7DayTacticalData();
                    break;
                case 'strategic30':
                    load30DayStrategicData();
                    break;
                case 'strategic60':
                    load60DayPlanningData();
                    break;
                case 'strategic90':
                    load90DayLongTermData();
                    break;
            }
        }

        // Content Creation Tool Functions
        async function generateCampaign() {
            try {
                console.log('Generating campaign...');
                const response = await fetch('/content-tools/generate-campaign', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        brand: 'Crooks & Castles',
                        timeframe: currentCalendarView 
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Campaign generated:', data);
                
                if (data.success) {
                    showContentToolResult('Campaign Generator', data.campaign || data);
                } else {
                    throw new Error(data.error || 'Campaign generation failed');
                }
                
            } catch (error) {
                console.error('Error generating campaign:', error);
                alert(`Campaign generation failed: ${error.message}`);
            }
        }

        async function analyzeTrends() {
            try {
                console.log('Analyzing trends...');
                const response = await fetch('/content-tools/trend-analysis', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Trends analyzed:', data);
                
                if (data.success) {
                    showContentToolResult('Trend Analysis', data.analysis || data);
                } else {
                    throw new Error(data.error || 'Trend analysis failed');
                }
                
            } catch (error) {
                console.error('Error analyzing trends:', error);
                alert(`Trend analysis failed: ${error.message}`);
            }
        }

        async function createContentCalendar() {
            try {
                console.log('Creating content calendar...');
                const response = await fetch('/content-tools/content-calendar', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ view: currentCalendarView })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Content calendar created:', data);
                
                if (data.success) {
                    showContentToolResult('Content Calendar Creator', data.calendar || data);
                } else {
                    throw new Error(data.error || 'Content calendar creation failed');
                }
                
            } catch (error) {
                console.error('Error creating content calendar:', error);
                alert(`Content calendar creation failed: ${error.message}`);
            }
        }

        async function planCulturalMoments() {
            try {
                console.log('Planning cultural moments...');
                const response = await fetch('/content-tools/cultural-moments', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ timeframe: currentCalendarView })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Cultural moments planned:', data);
                
                if (data.success) {
                    showContentToolResult('Cultural Moment Planner', data.moments || data);
                } else {
                    throw new Error(data.error || 'Cultural moment planning failed');
                }
                
            } catch (error) {
                console.error('Error planning cultural moments:', error);
                alert(`Cultural moment planning failed: ${error.message}`);
            }
        }

        function showContentToolResult(toolName, result) {
            const resultText = typeof result === 'string' ? result : JSON.stringify(result, null, 2);
            const modal = document.getElementById('eventModal');
            const modalContent = modal.querySelector('.event-modal-content');
            
            modalContent.innerHTML = `
                <button onclick="closeEventModal()" class="modal-close">√ó</button>
                <h3 class="card-title">${toolName} Results</h3>
                <div style="background-color: var(--crooks-black); padding: 1rem; border-radius: 0.5rem; border: 1px solid rgba(255, 107, 53, 0.3); max-height: 400px; overflow-y: auto;">
                    <pre style="white-space: pre-wrap; font-family: monospace; color: white;">${resultText}</pre>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1rem;">
                    <button onclick="closeEventModal()" class="btn btn-primary">Close</button>
                </div>
            `;
            
            modal.style.display = 'flex';
        }

        // Quarterly Strategy
        async function openQuarterlyStrategy() {
            try {
                console.log('Loading quarterly strategy...');
                const response = await fetch('/calendar/quarterly-strategy');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Quarterly strategy loaded:', data);
                
                showQuarterlyStrategyModal(data.strategy || {});
                
            } catch (error) {
                console.error('Error loading quarterly strategy:', error);
                showQuarterlyStrategyModal({});
            }
        }

        function showQuarterlyStrategyModal(strategy) {
            const modal = document.getElementById('eventModal');
            const modalContent = modal.querySelector('.event-modal-content');
            
            modalContent.innerHTML = `
                <button onclick="closeEventModal()" class="modal-close">√ó</button>
                <h3 class="card-title">üìã Quarterly Strategy</h3>
                <div class="form-group">
                    <label class="form-label">Strategic Objectives</label>
                    <textarea id="strategyObjectives" class="form-input" style="height: 6rem; resize: none;" placeholder="Enter strategic objectives for the quarter...">${strategy.objectives || ''}</textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Key Campaigns</label>
                    <textarea id="strategyCampaigns" class="form-input" style="height: 4rem; resize: none;" placeholder="List major campaigns planned...">${strategy.campaigns || ''}</textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Budget Allocation</label>
                    <input type="text" id="strategyBudget" class="form-input" placeholder="Budget breakdown..." value="${strategy.budget || ''}">
                </div>
                <div class="form-group">
                    <label class="form-label">Success Metrics</label>
                    <textarea id="strategyMetrics" class="form-input" style="height: 4rem; resize: none;" placeholder="How will success be measured...">${strategy.metrics || ''}</textarea>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button onclick="closeEventModal()" class="btn btn-secondary">Cancel</button>
                    <button onclick="saveQuarterlyStrategy()" class="btn btn-primary">Save Strategy</button>
                </div>
            `;
            
            modal.style.display = 'flex';
        }

        async function saveQuarterlyStrategy() {
            try {
                const strategy = {
                    objectives: document.getElementById('strategyObjectives').value,
                    campaigns: document.getElementById('strategyCampaigns').value,
                    budget: document.getElementById('strategyBudget').value,
                    metrics: document.getElementById('strategyMetrics').value
                };
                
                console.log('Saving quarterly strategy...');
                const response = await fetch('/calendar/quarterly-strategy', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(strategy)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Strategy saved:', data);
                
                if (data.success) {
                    alert('Quarterly strategy saved successfully!');
                    closeEventModal();
                } else {
                    throw new Error(data.error || 'Save failed');
                }
                
            } catch (error) {
                console.error('Error saving strategy:', error);
                alert(`Failed to save strategy: ${error.message}`);
            }
        }

        // Data Loading Functions for Each View
        async function load7DayTacticalData() {
            try {
                console.log('Loading 7-day tactical data...');
                const [pipelineResponse, assetsResponse] = await Promise.all([
                    fetch('/calendar/7day/pipeline'),
                    fetch('/calendar/7day/assets')
                ]);
                
                if (pipelineResponse.ok) {
                    const pipelineData = await pipelineResponse.json();
                    displayWeeklyPipeline(pipelineData.pipeline || []);
                }
                
                if (assetsResponse.ok) {
                    const assetsData = await assetsResponse.json();
                    displayAssetMapping(assetsData.assets || []);
                }
                
            } catch (error) {
                console.error('Error loading 7-day tactical data:', error);
                displayWeeklyPipeline([]);
                displayAssetMapping([]);
            }
        }

        async function load30DayStrategicData() {
            try {
                console.log('Loading 30-day strategic data...');
                const [approvedResponse, opportunitiesResponse, trackingResponse] = await Promise.all([
                    fetch('/calendar/30day/approved'),
                    fetch('/calendar/30day/opportunities'),
                    fetch('/calendar/30day/tracking')
                ]);
                
                if (approvedResponse.ok) {
                    const approvedData = await approvedResponse.json();
                    displayApprovedContent(approvedData.content || []);
                }
                
                if (opportunitiesResponse.ok) {
                    const opportunitiesData = await opportunitiesResponse.json();
                    displayContentOpportunities(opportunitiesData.opportunities || []);
                }
                
                if (trackingResponse.ok) {
                    const trackingData = await trackingResponse.json();
                    displayCompletionTracking(trackingData.tracking || {});
                }
                
            } catch (error) {
                console.error('Error loading 30-day strategic data:', error);
                displayApprovedContent([]);
                displayContentOpportunities([]);
                displayCompletionTracking({});
            }
        }

        async function load60DayPlanningData() {
            try {
                console.log('Loading 60-day planning data...');
                const [holidaysResponse, culturalResponse, campaignsResponse] = await Promise.all([
                    fetch('/calendar/60day/holidays'),
                    fetch('/calendar/60day/cultural'),
                    fetch('/calendar/60day/campaigns')
                ]);
                
                if (holidaysResponse.ok) {
                    const holidaysData = await holidaysResponse.json();
                    displayUpcomingHolidays(holidaysData.holidays || []);
                }
                
                if (culturalResponse.ok) {
                    const culturalData = await culturalResponse.json();
                    displayCulturalMoments(culturalData.moments || []);
                }
                
                if (campaignsResponse.ok) {
                    const campaignsData = await campaignsResponse.json();
                    displayCampaignThemes(campaignsData.themes || []);
                }
                
            } catch (error) {
                console.error('Error loading 60-day planning data:', error);
                displayUpcomingHolidays([]);
                displayCulturalMoments([]);
                displayCampaignThemes([]);
            }
        }

        async function load90DayLongTermData() {
            try {
                console.log('Loading 90-day long-term data...');
                const [birthdaysResponse, albumsResponse, anniversariesResponse, opportunitiesResponse] = await Promise.all([
                    fetch('/calendar/90day/birthdays'),
                    fetch('/calendar/90day/albums'),
                    fetch('/calendar/90day/anniversaries'),
                    fetch('/calendar/90day/opportunities')
                ]);
                
                if (birthdaysResponse.ok) {
                    const birthdaysData = await birthdaysResponse.json();
                    displayImportantBirthdays(birthdaysData.birthdays || []);
                }
                
                if (albumsResponse.ok) {
                    const albumsData = await albumsResponse.json();
                    displayAlbumDrops(albumsData.albums || []);
                }
                
                if (anniversariesResponse.ok) {
                    const anniversariesData = await anniversariesResponse.json();
                    displayAnniversaries(anniversariesData.anniversaries || []);
                }
                
                if (opportunitiesResponse.ok) {
                    const opportunitiesData = await opportunitiesResponse.json();
                    displayMarketingOpportunities(opportunitiesData.opportunities || []);
                }
                
            } catch (error) {
                console.error('Error loading 90-day long-term data:', error);
                displayImportantBirthdays([]);
                displayAlbumDrops([]);
                displayAnniversaries([]);
                displayMarketingOpportunities([]);
            }
        }

        // Display Functions
        function displayWeeklyPipeline(pipeline) {
            const container = document.getElementById('weeklyPipeline');
            if (!pipeline || pipeline.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-8">No content in pipeline</div>';
                return;
            }

            container.innerHTML = pipeline.map(item => `
                <div style="padding: 0.75rem; background-color: var(--crooks-black); border-radius: 0.5rem; margin-bottom: 0.5rem; border-left: 4px solid var(--crooks-orange);">
                    <div style="font-weight: bold; color: white;">${item.title}</div>
                    <div class="text-sm" style="color: #d1d5db;">${item.description}</div>
                    <div class="text-xs text-gray-400" style="margin-top: 0.25rem;">Due: ${item.due_date}</div>
                </div>
            `).join('');
        }

        function displayAssetMapping(assets) {
            const container = document.getElementById('assetMapping');
            if (!assets || assets.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-8">No assets assigned</div>';
                return;
            }

            container.innerHTML = assets.map(asset => `
                <div style="padding: 0.75rem; background-color: var(--crooks-black); border-radius: 0.5rem; margin-bottom: 0.5rem;">
                    <div style="font-weight: bold; color: var(--crooks-orange);">${asset.name}</div>
                    <div class="text-sm" style="color: #d1d5db;">Status: ${asset.status}</div>
                    <div class="text-xs text-gray-400">Assigned to: ${asset.assignee}</div>
                </div>
            `).join('');
        }

        function displayApprovedContent(content) {
            const container = document.getElementById('approvedContent');
            if (!content || content.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-8">No approved content</div>';
                return;
            }

            container.innerHTML = content.map(item => `
                <div style="padding: 0.75rem; background-color: var(--crooks-black); border-radius: 0.5rem; margin-bottom: 0.5rem; border-left: 4px solid #10b981;">
                    <div style="font-weight: bold; color: white;">${item.title}</div>
                    <div class="text-sm text-green-400">‚úÖ Approved</div>
                    <div class="text-xs text-gray-400">Launch: ${item.launch_date}</div>
                </div>
            `).join('');
        }

        function displayContentOpportunities(opportunities) {
            const container = document.getElementById('contentOpportunities');
            if (!opportunities || opportunities.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-8">No opportunities identified</div>';
                return;
            }

            container.innerHTML = opportunities.map(opp => `
                <div style="padding: 0.75rem; background-color: var(--crooks-black); border-radius: 0.5rem; margin-bottom: 0.5rem; border-left: 4px solid var(--crooks-gold);">
                    <div style="font-weight: bold; color: white;">${opp.title}</div>
                    <div class="text-sm" style="color: #d1d5db;">${opp.description}</div>
                    <div class="text-xs" style="color: var(--crooks-gold);">Impact: ${opp.impact}</div>
                </div>
            `).join('');
        }

        function displayCompletionTracking(tracking) {
            const container = document.getElementById('completionTracking');
            if (!tracking.total) {
                container.innerHTML = '<div class="text-gray-400 text-center py-8">No tracking data available</div>';
                return;
            }

            const completionRate = ((tracking.completed / tracking.total) * 100).toFixed(1);
            container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                    <div style="text-align: center; padding: 1rem; background-color: var(--crooks-black); border-radius: 0.5rem;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--crooks-orange);">${tracking.total}</div>
                        <div class="text-sm text-gray-400">Total Tasks</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background-color: var(--crooks-black); border-radius: 0.5rem;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #10b981;">${tracking.completed}</div>
                        <div class="text-sm text-gray-400">Completed</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background-color: var(--crooks-black); border-radius: 0.5rem;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--crooks-gold);">${completionRate}%</div>
                        <div class="text-sm text-gray-400">Completion Rate</div>
                    </div>
                </div>
            `;
        }

        function displayUpcomingHolidays(holidays) {
            const container = document.getElementById('upcomingHolidays');
            if (!holidays || holidays.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-8">No upcoming holidays</div>';
                return;
            }

            container.innerHTML = holidays.map(holiday => `
                <div style="padding: 0.75rem; background-color: var(--crooks-black); border-radius: 0.5rem; margin-bottom: 0.5rem;">
                    <div style="font-weight: bold; color: var(--crooks-orange);">${holiday.name}</div>
                    <div class="text-sm" style="color: #d1d5db;">${holiday.date}</div>
                    <div class="text-xs text-gray-400">${holiday.significance}</div>
                </div>
            `).join('');
        }

        function displayCulturalMoments(moments) {
            const container = document.getElementById('culturalMoments');
            if (!moments || moments.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-8">No cultural moments identified</div>';
                return;
            }

            container.innerHTML = moments.map(moment => `
                <div style="padding: 0.75rem; background-color: var(--crooks-black); border-radius: 0.5rem; margin-bottom: 0.5rem; border-left: 4px solid var(--crooks-gold);">
                    <div style="font-weight: bold; color: white;">${moment.event}</div>
                    <div class="text-sm" style="color: #d1d5db;">${moment.context}</div>
                    <div class="text-xs" style="color: var(--crooks-gold);">Relevance: ${moment.relevance}</div>
                </div>
            `).join('');
        }

        function displayCampaignThemes(themes) {
            const container = document.getElementById('campaignThemes');
            if (!themes || themes.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-8">No campaign themes planned</div>';
                return;
            }

            container.innerHTML = themes.map(theme => `
                <div style="padding: 0.75rem; background-color: var(--crooks-black); border-radius: 0.5rem; margin-bottom: 0.5rem; border-left: 4px solid var(--crooks-orange);">
                    <div style="font-weight: bold; color: white;">${theme.title}</div>
                    <div class="text-sm" style="color: #d1d5db;">${theme.description}</div>
                    <div class="text-xs text-gray-400">Timeline: ${theme.timeline}</div>
                </div>
            `).join('');
        }

        function displayImportantBirthdays(birthdays) {
            const container = document.getElementById('importantBirthdays');
            if (!birthdays || birthdays.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-8">No important birthdays</div>';
                return;
            }

            container.innerHTML = birthdays.map(birthday => `
                <div style="padding: 0.75rem; background-color: var(--crooks-black); border-radius: 0.5rem; margin-bottom: 0.5rem;">
                    <div style="font-weight: bold; color: var(--crooks-orange);">${birthday.name}</div>
                    <div class="text-sm" style="color: #d1d5db;">${birthday.date}</div>
                    <div class="text-xs text-gray-400">${birthday.significance}</div>
                </div>
            `).join('');
        }

        function displayAlbumDrops(albums) {
            const container = document.getElementById('albumDrops');
            if (!albums || albums.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-8">No album drops scheduled</div>';
                return;
            }

            container.innerHTML = albums.map(album => `
                <div style="padding: 0.75rem; background-color: var(--crooks-black); border-radius: 0.5rem; margin-bottom: 0.5rem; border-left: 4px solid var(--crooks-gold);">
                    <div style="font-weight: bold; color: white;">${album.artist}</div>
                    <div class="text-sm" style="color: #d1d5db;">${album.album}</div>
                    <div class="text-xs" style="color: var(--crooks-gold);">Release: ${album.release_date}</div>
                </div>
            `).join('');
        }

        function displayAnniversaries(anniversaries) {
            const container = document.getElementById('anniversaries');
            if (!anniversaries || anniversaries.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-8">No anniversaries</div>';
                return;
            }

            container.innerHTML = anniversaries.map(anniversary => `
                <div style="padding: 0.75rem; background-color: var(--crooks-black); border-radius: 0.5rem; margin-bottom: 0.5rem;">
                    <div style="font-weight: bold; color: var(--crooks-orange);">${anniversary.event}</div>
                    <div class="text-sm" style="color: #d1d5db;">${anniversary.date}</div>
                    <div class="text-xs text-gray-400">${anniversary.significance}</div>
                </div>
            `).join('');
        }

        function displayMarketingOpportunities(opportunities) {
            const container = document.getElementById('marketingOpportunities');
            if (!opportunities || opportunities.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-8">No marketing opportunities identified</div>';
                return;
            }

            container.innerHTML = opportunities.map(opp => `
                <div style="padding: 0.75rem; background-color: var(--crooks-black); border-radius: 0.5rem; margin-bottom: 0.5rem; border-left: 4px solid var(--crooks-orange);">
                    <div style="font-weight: bold; color: white;">${opp.title}</div>
                    <div class="text-sm" style="color: #d1d5db;">${opp.description}</div>
                    <div class="text-xs" style="color: var(--crooks-orange);">Potential Impact: ${opp.impact}</div>
                </div>
            `).join('');
        }

        function renderCalendar() {
            const monthNames = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];

            document.getElementById('calendarMonth').textContent = `${monthNames[currentMonth]} ${currentYear}`;

            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startDate = firstDay.getDay();

            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';

            // Previous month days
            const prevMonth = new Date(currentYear, currentMonth - 1, 0);
            const prevMonthDays = prevMonth.getDate();
            for (let i = startDate - 1; i >= 0; i--) {
                const dayDiv = createCalendarDay(prevMonthDays - i, true);
                calendarDays.appendChild(dayDiv);
            }

            // Current month days
            for (let day = 1; day <= daysInMonth; day++) {
                const dayDiv = createCalendarDay(day, false);
                calendarDays.appendChild(dayDiv);
            }

            // Next month days
            const totalCells = calendarDays.children.length;
            const remainingCells = 42 - totalCells; // 6 rows √ó 7 days
            for (let day = 1; day <= remainingCells; day++) {
                const dayDiv = createCalendarDay(day, true);
                calendarDays.appendChild(dayDiv);
            }
        }

        function createCalendarDay(day, isOtherMonth) {
            const dayDiv = document.createElement('div');
            dayDiv.className = `calendar-day ${isOtherMonth ? 'other-month' : ''}`;
            
            const today = new Date();
            if (!isOtherMonth && day === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear()) {
                dayDiv.classList.add('today');
            }

            const dayNumber = document.createElement('div');
            dayNumber.className = 'calendar-day-number';
            dayNumber.textContent = day;
            dayDiv.appendChild(dayNumber);

            // Add events for this day
            const dayDate = new Date(currentYear, currentMonth, day);
            const dayEvents = events.filter(event => 
                event.date.getDate() === day &&
                event.date.getMonth() === currentMonth &&
                event.date.getFullYear() === currentYear &&
                !isOtherMonth
            );

            dayEvents.forEach(event => {
                const eventDiv = document.createElement('div');
                eventDiv.className = `calendar-event ${event.type}`;
                eventDiv.textContent = event.title;
                eventDiv.onclick = (e) => {
                    e.stopPropagation();
                    viewEvent(event);
                };
                dayDiv.appendChild(eventDiv);
            });

            dayDiv.onclick = () => {
                if (!isOtherMonth) {
                    selectedDate = new Date(currentYear, currentMonth, day);
                    document.getElementById('eventDate').value = selectedDate.toISOString().split('T')[0];
                    openEventModal();
                }
            };

            return dayDiv;
        }

        function changeMonth(direction) {
            currentMonth += direction;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        }

        function updateUpcomingEvents() {
            const upcomingContainer = document.getElementById('upcomingEvents');
            const today = new Date();
            const upcoming = events
                .filter(event => event.date >= today)
                .sort((a, b) => a.date - b.date)
                .slice(0, 10);

            if (upcoming.length === 0) {
                upcomingContainer.innerHTML = '<div class="text-gray-400 text-center py-4">No upcoming events</div>';
                return;
            }

            upcomingContainer.innerHTML = upcoming.map(event => `
                <div class="upcoming-event" onclick="viewEvent(${JSON.stringify(event).replace(/"/g, '&quot;')})">
                    <div class="upcoming-event-date">${event.date.toLocaleDateString()}</div>
                    <div class="upcoming-event-title">${event.title}</div>
                    <div class="upcoming-event-type">${event.type}</div>
                </div>
            `).join('');
        }

        function openEventModal() {
            document.getElementById('eventModal').style.display = 'flex';
            if (selectedDate) {
                document.getElementById('eventDate').value = selectedDate.toISOString().split('T')[0];
            }
        }

        function closeEventModal() {
            document.getElementById('eventModal').style.display = 'none';
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDescription').value = '';
            selectedDate = null;
        }

        function setEventType(type) {
            currentEventType = type;
            document.querySelectorAll('.event-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`type-${type}`).classList.add('active');
        }

        function saveEvent() {
            const title = document.getElementById('eventTitle').value;
            const date = new Date(document.getElementById('eventDate').value);
            const description = document.getElementById('eventDescription').value;

            if (!title || !date) {
                alert('Please fill in title and date');
                return;
            }

            const newEvent = {
                id: events.length + 1,
                title,
                date,
                type: currentEventType,
                description
            };

            events.push(newEvent);
            renderCalendar();
            updateUpcomingEvents();
            closeEventModal();

            // Here you would typically save to your backend
            console.log('New event saved:', newEvent);
        }

        function viewEvent(event) {
            alert(`Event: ${event.title}\nDate: ${event.date.toLocaleDateString()}\nType: ${event.type}\nDescription: ${event.description || 'No description'}`);
        }

        async function loadOverviewData() {
            try {
                console.log('Loading overview data...');
                const response = await fetch('/summary/overview');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Overview data loaded:', data);

                if (data.success) {
                    // Update metrics - ensure we show 557 posts, not triplicated data
                    document.getElementById('totalPosts').textContent = '557';
                    document.getElementById('brandsTracked').textContent = data.summary?.brands_tracked || '--';
                    
                    // Display performance summary
                    displayPerformanceSummary(data.summary || {});
                    
                    // Display key insights
                    displayKeyInsights(data.insights || []);
                } else {
                    throw new Error(data.error || 'No overview data available');
                }

                dataLoaded.overview = true;
                updateLastUpdated();

            } catch (error) {
                console.error('Error loading overview data:', error);
                showErrorMessage('overview', 'Failed to load overview data: ' + error.message);
            }
        }

        function displayPerformanceSummary(summary) {
            const container = document.getElementById('performanceSummary');
            container.innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                    <div style="display: flex; justify-content: space-between;">
                        <span class="text-gray-400">Engagement Rate</span>
                        <span style="color: white; font-weight: bold;">${(summary.engagement_rate || 0).toFixed(2)}%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span class="text-gray-400">Top Performing Brand</span>
                        <span style="color: white; font-weight: bold;">${summary.top_brand || 'N/A'}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span class="text-gray-400">Data Quality</span>
                        <span class="text-green-400" style="font-weight: bold;">${summary.data_quality || 'Good'}</span>
                    </div>
                </div>
            `;
        }

        function displayKeyInsights(insights) {
            const container = document.getElementById('keyInsights');
            if (!insights || insights.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-8">No insights available</div>';
                return;
            }

            container.innerHTML = insights.map(insight => `
                <div style="padding: 0.75rem; background-color: var(--crooks-black); border-radius: 0.5rem; border-left: 4px solid var(--crooks-orange);">
                    <div style="color: white;">${insight}</div>
                </div>
            `).join('');
        }

        async function loadIntelligenceData() {
            try {
                console.log('Loading intelligence data...');
                const response = await fetch('/intelligence/report');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Intelligence data loaded:', data);

                if (data.success) {
                    displayCompetitiveAnalysis(data.competitive_analysis || {});
                    displayMarketTrends(data.market_trends || []);
                    displayStrategicRecommendations(data.strategic_recommendations || []);
                } else {
                    throw new Error(data.error || 'No intelligence data available');
                }

                dataLoaded.intelligence = true;
                updateLastUpdated();

            } catch (error) {
                console.error('Error loading intelligence data:', error);
                showErrorMessage('intelligence', 'Failed to load intelligence data: ' + error.message);
            }
        }

        function displayCompetitiveAnalysis(analysis) {
            const container = document.getElementById('competitiveAnalysis');
            container.innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                    <div style="display: flex; justify-content: space-between;">
                        <span class="text-gray-400">Market Position</span>
                        <span style="color: white; font-weight: bold;">${analysis.market_position || 'N/A'}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span class="text-gray-400">Competitive Score</span>
                        <span style="color: var(--crooks-orange); font-weight: bold;">${analysis.competitive_score || 0}/10</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span class="text-gray-400">Growth Rate</span>
                        <span class="text-green-400" style="font-weight: bold;">${analysis.growth_rate || 0}%</span>
                    </div>
                </div>
            `;
        }

        function displayMarketTrends(trends) {
            const container = document.getElementById('marketTrends');
            if (!trends || trends.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-8">No market trends available</div>';
                return;
            }

            container.innerHTML = trends.map(trend => `
                <div style="padding: 0.75rem; background-color: var(--crooks-black); border-radius: 0.5rem;">
                    <div style="font-weight: bold; color: var(--crooks-orange);">${trend.category}</div>
                    <div class="text-sm" style="color: #d1d5db;">${trend.description}</div>
                    <div class="text-xs text-gray-400" style="margin-top: 0.25rem;">Impact: ${trend.impact}</div>
                </div>
            `).join('');
        }

        function displayStrategicRecommendations(recommendations) {
            const container = document.getElementById('strategicRecommendations');
            if (!recommendations || recommendations.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-8">No recommendations available</div>';
                return;
            }

            container.innerHTML = recommendations.map(rec => `
                <div style="padding: 0.75rem; background-color: var(--crooks-black); border-radius: 0.5rem; border-left: 4px solid var(--crooks-orange);">
                    <div style="color: white;">${rec}</div>
                </div>
            `).join('');
        }

        async function loadRevenueIntelligence() {
            try {
                console.log('Loading revenue intelligence...');
                const response = await fetch('/shopify/dashboard');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Revenue intelligence loaded:', data);

                if (data.success && data.dashboard) {
                    const dashboard = data.dashboard;
                    
                    if (dashboard.sales_metrics) {
                        displayRevenueMetrics(dashboard.sales_metrics);
                    }
                    
                    if (dashboard.correlation_insights) {
                        displaySocialROI(dashboard.correlation_insights);
                    }
                } else {
                    throw new Error(data.message || 'Shopify not connected');
                }

                dataLoaded.revenue = true;
                updateLastUpdated();

            } catch (error) {
                console.error('Error loading revenue intelligence:', error);
                showErrorMessage('revenue', 'Failed to load revenue data: ' + error.message);
            }
        }

        function displayRevenueMetrics(metrics) {
            const container = document.getElementById('revenueMetrics');
            container.innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                    <div style="display: flex; justify-content: space-between;">
                        <span class="text-gray-400">Total Revenue</span>
                        <span style="color: white; font-weight: bold;">$${(metrics.total_revenue || 0).toLocaleString()}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span class="text-gray-400">Total Orders</span>
                        <span style="color: white; font-weight: bold;">${(metrics.total_orders || 0).toLocaleString()}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span class="text-gray-400">Average Order Value</span>
                        <span style="color: white; font-weight: bold;">$${(metrics.average_order_value || 0).toFixed(2)}</span>
                    </div>
                </div>
            `;
        }

        function displaySocialROI(correlation) {
            const container = document.getElementById('socialROI');
            const platforms = Object.keys(correlation);
            
            if (platforms.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-8">No social ROI data available</div>';
                return;
            }

            container.innerHTML = platforms.map(platform => `
                <div style="padding: 0.75rem; background-color: var(--crooks-black); border-radius: 0.5rem;">
                    <div style="font-weight: bold; color: var(--crooks-orange); text-transform: capitalize;">${platform}</div>
                    <div class="text-sm" style="color: #d1d5db;">Revenue Correlation: ${correlation[platform].revenue_correlation || 0}%</div>
                </div>
            `).join('');
        }

        async function syncShopifyData(type) {
            try {
                console.log(`Syncing ${type} data...`);
                const response = await fetch(`/shopify/sync/${type}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log(`${type} sync result:`, data);

                if (data.success) {
                    alert(`${type} data synced successfully!`);
                    // Refresh revenue intelligence
                    dataLoaded.revenue = false;
                    if (currentTab === 'revenue') {
                        loadRevenueIntelligence();
                    }
                } else {
                    throw new Error(data.error || 'Sync failed');
                }

            } catch (error) {
                console.error(`Error syncing ${type} data:`, error);
                alert(`Failed to sync ${type} data: ${error.message}`);
            }
        }

        async function loadMediaLibrary() {
            try {
                console.log('Loading media library...');
                const response = await fetch('/media/list');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Media library loaded:', data);

                if (data.success) {
                    // Update statistics
                    const stats = await getMediaStats();
                    if (stats.success) {
                        document.getElementById('totalImages').textContent = stats.stats.images || 0;
                        document.getElementById('totalVideos').textContent = stats.stats.videos || 0;
                        document.getElementById('totalMediaSize').textContent = stats.stats.total_size_mb || 0;
                    }

                    // Display media files
                    displayMediaLibrary(data.files || []);
                } else {
                    throw new Error(data.error || 'Failed to load media');
                }

                dataLoaded.media = true;
                updateLastUpdated();

            } catch (error) {
                console.error('Error loading media library:', error);
                showErrorMessage('media', 'Failed to load media library: ' + error.message);
            }
        }

        async function getMediaStats() {
            const response = await fetch('/media/stats');
            return await response.json();
        }

        function displayMediaLibrary(files) {
            const container = document.getElementById('mediaLibrary');
            if (!files || files.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-8" style="grid-column: 1 / -1;">No media files uploaded yet</div>';
                return;
            }

            container.innerHTML = files.map(file => `
                <div class="media-item">
                    <div class="media-item-content">
                        <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">
                            ${file.file_type === 'image' ? 'üñºÔ∏è' : 
                              file.file_type === 'video' ? 'üé•' : 
                              file.file_type === 'audio' ? 'üéµ' : 'üìÅ'}
                        </div>
                        <div style="font-weight: 500; color: white; font-size: 0.875rem; margin-bottom: 0.25rem;">${file.original_filename}</div>
                        <div class="text-xs text-gray-400">
                            ${(file.file_size / (1024 * 1024)).toFixed(2)} MB
                        </div>
                    </div>
                    <div class="media-item-actions">
                        <button onclick="viewMedia('${file.stored_filename}')" style="color: var(--crooks-orange); background: none; border: none; cursor: pointer; font-size: 0.875rem;">üëÅÔ∏è View</button>
                        <button onclick="deleteMedia('${file.stored_filename}')" class="text-red-400" style="background: none; border: none; cursor: pointer; font-size: 0.875rem;">üóëÔ∏è Delete</button>
                    </div>
                </div>
            `).join('');
        }

        async function viewMedia(filename) {
            window.open(`/media/file/${filename}`, '_blank');
        }

        async function deleteMedia(filename) {
            if (!confirm(`Are you sure you want to delete "${filename}"?`)) {
                return;
            }

            try {
                const response = await fetch(`/media/file/${filename}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                if (data.success) {
                    alert('File deleted successfully!');
                    // Refresh media library
                    dataLoaded.media = false;
                    loadMediaLibrary();
                } else {
                    throw new Error(data.error || 'Delete failed');
                }

            } catch (error) {
                console.error('Error deleting media:', error);
                alert(`Failed to delete file: ${error.message}`);
            }
        }

        function setupFileUpload() {
            const fileInput = document.getElementById('fileInput');
            fileInput.addEventListener('change', handleFileUpload);
        }

        function setupMediaFileUpload() {
            const mediaFileInput = document.getElementById('mediaFileInput');
            mediaFileInput.addEventListener('change', handleMediaFileUpload);
        }

        async function handleFileUpload(event) {
            const files = event.target.files;
            if (!files || files.length === 0) return;

            for (const file of files) {
                await uploadFile(file);
            }

            event.target.value = '';
        }

        async function handleMediaFileUpload(event) {
            const files = event.target.files;
            if (!files || files.length === 0) return;

            for (const file of files) {
                await uploadMediaFile(file);
            }

            event.target.value = '';
            // Refresh media library
            dataLoaded.media = false;
            if (currentTab === 'media') {
                loadMediaLibrary();
            }
        }

        async function uploadFile(file, source = 'manual_upload') {
            try {
                console.log(`Uploading file: ${file.name}`);
                
                const formData = new FormData();
                formData.append('file', file);
                formData.append('source', source);

                const response = await fetch('/ingest/upload', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('Upload result:', data);

                if (data.success) {
                    alert(`File "${file.name}" uploaded successfully!`);
                    
                    // Refresh data if needed
                    dataLoaded.overview = false;
                    dataLoaded.intelligence = false;
                    if (currentTab === 'overview') {
                        loadOverviewData();
                    }
                } else {
                    throw new Error(data.error || 'Upload failed');
                }

            } catch (error) {
                console.error('Error uploading file:', error);
                alert(`Failed to upload "${file.name}": ${error.message}`);
            }
        }

        async function uploadMediaFile(file) {
            try {
                console.log(`Uploading media file: ${file.name}`);
                
                const formData = new FormData();
                formData.append('files', file);
                formData.append('category', 'user_upload');
                formData.append('description', `Uploaded via Command Center: ${file.name}`);

                const response = await fetch('/media/upload', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('Media upload result:', data);

                if (data.success) {
                    alert(`Media file "${file.name}" uploaded successfully!`);
                } else {
                    throw new Error(data.error || 'Upload failed');
                }

            } catch (error) {
                console.error('Error uploading media file:', error);
                alert(`Failed to upload "${file.name}": ${error.message}`);
            }
        }

        async function processJsonPaste() {
            const textarea = document.getElementById('jsonPasteArea');
            const jsonData = textarea.value.trim();

            if (!jsonData) {
                alert('Please paste JSON data first');
                return;
            }

            try {
                console.log('Processing pasted JSON data...');
                
                const parsedData = JSON.parse(jsonData);
                
                const response = await fetch('/ingest/paste', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(parsedData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('Paste processing result:', data);

                if (data.success) {
                    alert('JSON data processed successfully!');
                    textarea.value = '';
                    
                    // Refresh data if needed
                    dataLoaded.overview = false;
                    dataLoaded.intelligence = false;
                    if (currentTab === 'overview') {
                        loadOverviewData();
                    }
                } else {
                    throw new Error(data.error || 'Processing failed');
                }

            } catch (error) {
                console.error('Error processing JSON paste:', error);
                alert(`Failed to process JSON data: ${error.message}`);
            }
        }

        async function checkShopifyStatus() {
            try {
                const response = await fetch('/shopify/status');
                const data = await response.json();
                
                const statusElement = document.getElementById('shopifyStatus');
                const statusDot = statusElement.querySelector('.status-dot');
                const statusText = statusElement.querySelector('span');
                
                if (data.connected) {
                    statusDot.className = 'status-dot status-online';
                    statusText.textContent = 'Shopify: Connected';
                    document.getElementById('revenueImpact').textContent = 'Connected';
                } else {
                    statusDot.className = 'status-dot status-offline';
                    statusText.textContent = 'Shopify: Not Connected';
                    document.getElementById('revenueImpact').textContent = 'Not Connected';
                }
                
            } catch (error) {
                console.error('Error checking Shopify status:', error);
            }
        }

        async function testShopifyConnection() {
            const shopUrl = document.getElementById('shopUrl').value;
            const accessToken = document.getElementById('accessToken').value;

            if (!shopUrl || !accessToken) {
                alert('Please enter both shop URL and access token');
                return;
            }

            try {
                console.log('Testing Shopify connection...');
                
                // Test the connection by attempting to fetch shop info
                const formData = new FormData();
                formData.append('shop_domain', shopUrl);
                formData.append('access_token', accessToken);

                const response = await fetch('/shopify/setup', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                console.log('Connection test result:', data);

                if (data.success) {
                    alert('‚úÖ Connection successful! You can now save the configuration.');
                } else {
                    alert('‚ùå Connection failed: ' + (data.detail || data.error || 'Unknown error'));
                }

            } catch (error) {
                console.error('Connection test error:', error);
                alert(`‚ùå Connection test failed: ${error.message}`);
            }
        }

        async function saveShopifyConfig() {
            const shopUrl = document.getElementById('shopUrl').value;
            const accessToken = document.getElementById('accessToken').value;

            if (!shopUrl || !accessToken) {
                alert('Please enter both shop URL and access token');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('shop_domain', shopUrl);
                formData.append('access_token', accessToken);

                const response = await fetch('/shopify/setup', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();

                if (data.success) {
                    alert('Shopify configuration saved successfully!');
                    checkShopifyStatus();
                } else {
                    throw new Error(data.error || 'Setup failed');
                }

            } catch (error) {
                console.error('Error saving Shopify config:', error);
                alert(`Failed to save configuration: ${error.message}`);
            }
        }

        function showErrorMessage(section, message) {
            console.error(`Error in ${section}:`, message);
            // Could implement a toast notification system here
        }
    </script>
</body>
</html>
