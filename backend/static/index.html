<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>👑 Crooks & Castles Command Center V2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #000000 100%);
            font-family: 'Arial', sans-serif;
        }
        .gradient-border {
            background: linear-gradient(45deg, #ff6b35, #f7931e, #ffcc02);
            padding: 2px;
            border-radius: 12px;
        }
        .gradient-border-content {
            background: #1a1a1a;
            border-radius: 10px;
            padding: 1.5rem;
        }
        .crown-glow {
            text-shadow: 0 0 20px #ff6b35;
        }
        .stat-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 1px solid #ff6b35;
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.3);
        }
        .upload-zone {
            border: 2px dashed #ff6b35;
            background: rgba(255, 107, 53, 0.1);
            transition: all 0.3s ease;
        }
        .upload-zone:hover {
            background: rgba(255, 107, 53, 0.2);
            border-color: #f7931e;
        }
        .nav-tab {
            transition: all 0.3s ease;
        }
        .nav-tab:hover {
            background: rgba(255, 107, 53, 0.2);
        }
        .nav-tab.active {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
        }
    </style>
</head>
<body class="bg-black text-white min-h-screen">
    <!-- Header -->
    <header class="p-6 border-b border-gray-800">
        <div class="flex justify-between items-center">
            <h1 class="text-4xl font-bold text-orange-500 crown-glow">👑 Crooks & Castles Command Center</h1>
            <div class="text-right">
                <div class="text-sm text-gray-400">Status: <span id="systemStatus" class="text-green-400">Online</span></div>
                <div class="text-sm text-gray-400">Shopify: <span id="shopifyStatus" class="text-yellow-400">Checking...</span></div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="p-4 border-b border-gray-800">
        <div class="flex space-x-4">
            <button class="nav-tab px-4 py-2 rounded-lg active" onclick="showTab('overview')">📊 Overview</button>
            <button class="nav-tab px-4 py-2 rounded-lg" onclick="showTab('intelligence')">🧠 Revenue Intelligence</button>
            <button class="nav-tab px-4 py-2 rounded-lg" onclick="showTab('calendar')">📅 Campaign Calendar</button>
            <button class="nav-tab px-4 py-2 rounded-lg" onclick="showTab('agency')">🤝 Agency Tracking</button>
            <button class="nav-tab px-4 py-2 rounded-lg" onclick="showTab('ingest')">📥 Data Ingest</button>
            <button class="nav-tab px-4 py-2 rounded-lg" onclick="showTab('shopify')">🛒 Shopify Setup</button>
        </div>
    </nav>

    <!-- Overview Tab -->
    <div id="overview" class="tab-content p-6">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="stat-card p-6 rounded-lg">
                <h3 class="text-lg font-semibold text-orange-400">Total Posts</h3>
                <p class="text-3xl font-bold" id="totalPosts">Loading...</p>
            </div>
            <div class="stat-card p-6 rounded-lg">
                <h3 class="text-lg font-semibold text-orange-400">Avg Engagement</h3>
                <p class="text-3xl font-bold" id="avgEngagement">Loading...</p>
            </div>
            <div class="stat-card p-6 rounded-lg">
                <h3 class="text-lg font-semibold text-orange-400">Data Files</h3>
                <p class="text-3xl font-bold" id="totalFiles">Loading...</p>
            </div>
            <div class="stat-card p-6 rounded-lg">
                <h3 class="text-lg font-semibold text-orange-400">Last Updated</h3>
                <p class="text-sm" id="lastUpdated">Loading...</p>
            </div>
        </div>

        <div class="gradient-border mb-6">
            <div class="gradient-border-content">
                <h3 class="text-xl font-bold text-orange-400 mb-4">🔥 Top Performing Content</h3>
                <div id="topContent">Loading top content...</div>
            </div>
        </div>
    </div>

    <!-- Intelligence Tab -->
    <div id="intelligence" class="tab-content p-6 hidden">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <button class="bg-orange-600 hover:bg-orange-700 px-6 py-3 rounded-lg font-semibold transition-colors" onclick="syncShopifyData('sales')">
                💰 Sync Sales Data
            </button>
            <button class="bg-orange-600 hover:bg-orange-700 px-6 py-3 rounded-lg font-semibold transition-colors" onclick="syncShopifyData('traffic')">
                📊 Sync Traffic Data
            </button>
            <button class="bg-orange-600 hover:bg-orange-700 px-6 py-3 rounded-lg font-semibold transition-colors" onclick="syncShopifyData('products')">
                🛍️ Sync Products Data
            </button>
        </div>

        <div class="gradient-border">
            <div class="gradient-border-content">
                <h3 class="text-xl font-bold text-orange-400 mb-4">🧠 Intelligence Report</h3>
                <div id="intelligenceReport">Loading intelligence data...</div>
            </div>
        </div>
    </div>

    <!-- Calendar Tab -->
    <div id="calendar" class="tab-content p-6 hidden">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <button class="bg-orange-600 hover:bg-orange-700 px-4 py-2 rounded-lg" onclick="loadCalendarView('tactical7')">7-Day Tactical</button>
            <button class="bg-orange-600 hover:bg-orange-700 px-4 py-2 rounded-lg" onclick="loadCalendarView('strategic30')">30-Day Strategic</button>
            <button class="bg-orange-600 hover:bg-orange-700 px-4 py-2 rounded-lg" onclick="loadCalendarView('strategic60')">60-Day Planning</button>
            <button class="bg-orange-600 hover:bg-orange-700 px-4 py-2 rounded-lg" onclick="loadCalendarView('strategic90')">90+ Long-term</button>
        </div>

        <div class="gradient-border">
            <div class="gradient-border-content">
                <h3 class="text-xl font-bold text-orange-400 mb-4">📅 Campaign Calendar</h3>
                <div id="calendarContent">Select a calendar view above to see content planning.</div>
            </div>
        </div>
    </div>

    <!-- Agency Tab -->
    <div id="agency" class="tab-content p-6 hidden">
        <div class="gradient-border">
            <div class="gradient-border-content">
                <h3 class="text-xl font-bold text-orange-400 mb-4">🤝 Agency Performance Tracking</h3>
                <div id="agencyContent">Loading agency tracking data...</div>
            </div>
        </div>
    </div>

    <!-- Data Ingest Tab -->
    <div id="ingest" class="tab-content p-6 hidden">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="gradient-border">
                <div class="gradient-border-content">
                    <h3 class="text-xl font-bold text-orange-400 mb-4">📤 Upload JSONL Files</h3>
                    <div class="upload-zone p-8 rounded-lg text-center">
                        <input type="file" id="fileInput" accept=".jsonl,.json" class="hidden" onchange="handleFileUpload()">
                        <button onclick="document.getElementById('fileInput').click()" class="bg-orange-600 hover:bg-orange-700 px-6 py-3 rounded-lg font-semibold">
                            Choose JSONL File
                        </button>
                        <p class="text-sm text-gray-400 mt-2">Upload your social media data files</p>
                    </div>
                    <div id="uploadStatus" class="mt-4"></div>
                </div>
            </div>

            <div class="gradient-border">
                <div class="gradient-border-content">
                    <h3 class="text-xl font-bold text-orange-400 mb-4">📁 Uploaded Files</h3>
                    <div id="filesList">Loading files...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Shopify Setup Tab -->
    <div id="shopify" class="tab-content p-6 hidden">
        <div class="gradient-border">
            <div class="gradient-border-content">
                <h3 class="text-xl font-bold text-orange-400 mb-4">🛒 Shopify Integration Setup</h3>
                <form id="shopifyForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Shop Domain (without .myshopify.com)</label>
                        <input type="text" id="shopDomain" placeholder="your-shop-name" class="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg">
                        <p class="text-xs text-gray-400 mt-1">Example: crooksonline</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Private App Access Token</label>
                        <input type="password" id="accessToken" placeholder="shpat_..." class="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg">
                    </div>
                    <button type="button" onclick="setupShopify()" class="bg-orange-600 hover:bg-orange-700 px-6 py-3 rounded-lg font-semibold">
                        Connect Shopify
                    </button>
                </form>
                <div id="shopifySetupStatus" class="mt-4"></div>
            </div>
        </div>
    </div>

    <script>
        // Tab Management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName).classList.remove('hidden');
            event.target.classList.add('active');
            
            // Load tab-specific data
            if (tabName === 'overview') loadOverviewData();
            if (tabName === 'intelligence') loadIntelligenceData();
            if (tabName === 'agency') loadAgencyData();
            if (tabName === 'ingest') loadFilesList();
        }

        // Load Overview Data
        async function loadOverviewData() {
            try {
                const response = await fetch('/ingest/overview');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('totalPosts').textContent = data.overview.total_posts;
                    document.getElementById('avgEngagement').textContent = data.overview.avg_engagement + '%';
                    document.getElementById('totalFiles').textContent = data.overview.total_files;
                    document.getElementById('lastUpdated').textContent = new Date(data.overview.last_updated).toLocaleString();
                    
                    // Display top content
                    const topContentHtml = data.top_content.map(post => `
                        <div class="bg-gray-800 p-4 rounded-lg mb-2">
                            <h4 class="font-semibold">${post.title}</h4>
                            <p class="text-sm text-gray-400">${post.platform} • ${post.likes} likes • ${post.engagement_rate}% engagement</p>
                        </div>
                    `).join('');
                    document.getElementById('topContent').innerHTML = topContentHtml || '<p class="text-gray-400">No content data available</p>';
                }
            } catch (error) {
                console.error('Error loading overview:', error);
            }
        }

        // Load Intelligence Data
        async function loadIntelligenceData() {
            try {
                const response = await fetch('/intelligence/report', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ days_back: 30 })
                });
                const data = await response.json();
                
                const reportHtml = `
                    <div class="space-y-4">
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <h4 class="font-semibold text-orange-400">Data Status</h4>
                            <p>${data.data_status === 'real_data' ? '✅ Analyzing real data' : '⚠️ No data available'}</p>
                            <p>Total Posts: ${data.total_posts}</p>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <h4 class="font-semibold text-orange-400">Sentiment Analysis</h4>
                            <p>Positive: ${data.sentiment_analysis.overall_positive}%</p>
                            <p>Negative: ${data.sentiment_analysis.overall_negative}%</p>
                            <p>Neutral: ${data.sentiment_analysis.overall_neutral}%</p>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <h4 class="font-semibold text-orange-400">Strategic Insights</h4>
                            ${data.strategic_insights.map(insight => `<p>• ${insight}</p>`).join('')}
                        </div>
                    </div>
                `;
                document.getElementById('intelligenceReport').innerHTML = reportHtml;
            } catch (error) {
                document.getElementById('intelligenceReport').innerHTML = '<p class="text-red-400">Error loading intelligence data</p>';
            }
        }

        // Shopify Sync Functions
        async function syncShopifyData(type) {
            try {
                const response = await fetch(`/shopify/sync/${type}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ days_back: 30 })
                });
                const data = await response.json();
                
                if (data.success) {
                    alert(`✅ ${type} data synced successfully!`);
                } else {
                    alert(`❌ ${data.error || 'Sync failed'}\n\n${data.action_required || ''}`);
                }
            } catch (error) {
                alert(`❌ Sync failed: ${error.message}`);
            }
        }

        // Calendar Functions
        async function loadCalendarView(viewType) {
            try {
                const response = await fetch(`/calendar/${viewType}`);
                const data = await response.json();
                
                if (data.success) {
                    let contentHtml = `<h4 class="font-semibold text-orange-400 mb-4">${data.view_type} (${data.date_range.start} to ${data.date_range.end})</h4>`;
                    
                    if (data.weekly_pipeline) {
                        contentHtml += '<div class="space-y-4">';
                        data.weekly_pipeline.forEach(day => {
                            contentHtml += `
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <h5 class="font-semibold">${day.date} - ${day.day}</h5>
                                    ${day.content.map(item => `
                                        <div class="ml-4 mt-2 text-sm">
                                            <span class="text-orange-400">${item.platform}</span> - ${item.title} 
                                            <span class="text-gray-400">(${item.status})</span>
                                        </div>
                                    `).join('')}
                                </div>
                            `;
                        });
                        contentHtml += '</div>';
                    }
                    
                    document.getElementById('calendarContent').innerHTML = contentHtml;
                } else {
                    document.getElementById('calendarContent').innerHTML = '<p class="text-red-400">Error loading calendar data</p>';
                }
            } catch (error) {
                document.getElementById('calendarContent').innerHTML = '<p class="text-red-400">Error loading calendar data</p>';
            }
        }

        // Agency Functions
        async function loadAgencyData() {
            try {
                const response = await fetch('/agency/status');
                const data = await response.json();
                
                if (data.success) {
                    const agencyHtml = `
                        <div class="space-y-4">
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <h4 class="font-semibold text-orange-400">Current Contract</h4>
                                <p>Agency: ${data.current_contract.agency_name}</p>
                                <p>Phase: ${data.current_contract.phase}</p>
                                <p>Budget: $${data.current_contract.monthly_budget}</p>
                            </div>
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <h4 class="font-semibold text-orange-400">Performance Metrics</h4>
                                <p>Brand Adherence: ${data.performance_metrics.brand_adherence_score}%</p>
                                <p>Deliverable Completion: ${data.performance_metrics.deliverable_completion_rate}%</p>
                            </div>
                        </div>
                    `;
                    document.getElementById('agencyContent').innerHTML = agencyHtml;
                } else {
                    document.getElementById('agencyContent').innerHTML = '<p class="text-red-400">Error loading agency data</p>';
                }
            } catch (error) {
                document.getElementById('agencyContent').innerHTML = '<p class="text-red-400">Error loading agency data</p>';
            }
        }

        // File Upload Functions
        async function handleFileUpload() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            const formData = new FormData();
            formData.append('file', file);
            formData.append('source', 'manual');
            
            document.getElementById('uploadStatus').innerHTML = '<p class="text-yellow-400">Uploading...</p>';
            
            try {
                const response = await fetch('/ingest/upload', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('uploadStatus').innerHTML = `<p class="text-green-400">✅ ${data.message}</p>`;
                    loadFilesList();
                    loadOverviewData();
                } else {
                    document.getElementById('uploadStatus').innerHTML = `<p class="text-red-400">❌ ${data.error}</p>`;
                }
            } catch (error) {
                document.getElementById('uploadStatus').innerHTML = `<p class="text-red-400">❌ Upload failed: ${error.message}</p>`;
            }
        }

        // Load Files List
        async function loadFilesList() {
            try {
                const response = await fetch('/ingest/data/list');
                const data = await response.json();
                
                if (data.success && data.files.length > 0) {
                    const filesHtml = data.files.map(file => `
                        <div class="bg-gray-800 p-3 rounded-lg flex justify-between items-center">
                            <div>
                                <p class="font-semibold">${file.filename}</p>
                                <p class="text-sm text-gray-400">${file.records} records • ${new Date(file.created).toLocaleString()}</p>
                            </div>
                            <button onclick="deleteFile('${file.filename}')" class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm">
                                Delete
                            </button>
                        </div>
                    `).join('');
                    document.getElementById('filesList').innerHTML = filesHtml;
                } else {
                    document.getElementById('filesList').innerHTML = '<p class="text-gray-400">No files uploaded yet</p>';
                }
            } catch (error) {
                document.getElementById('filesList').innerHTML = '<p class="text-red-400">Error loading files</p>';
            }
        }

        // Delete File
        async function deleteFile(filename) {
            if (!confirm(`Delete ${filename}?`)) return;
            
            try {
                const response = await fetch(`/ingest/data/${filename}`, { method: 'DELETE' });
                const data = await response.json();
                
                if (data.success) {
                    loadFilesList();
                    loadOverviewData();
                } else {
                    alert(`Delete failed: ${data.error}`);
                }
            } catch (error) {
                alert(`Delete failed: ${error.message}`);
            }
        }

        // Shopify Setup
        async function setupShopify() {
            const shopDomain = document.getElementById('shopDomain').value;
            const accessToken = document.getElementById('accessToken').value;
            
            if (!shopDomain || !accessToken) {
                alert('Please fill in all fields');
                return;
            }
            
            const formData = new FormData();
            formData.append('shop_domain', shopDomain);
            formData.append('access_token', accessToken);
            
            try {
                const response = await fetch('/shopify/setup', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('shopifySetupStatus').innerHTML = '<p class="text-green-400">✅ Shopify connected successfully!</p>';
                    checkShopifyStatus();
                } else {
                    document.getElementById('shopifySetupStatus').innerHTML = `<p class="text-red-400">❌ ${data.error}</p>`;
                }
            } catch (error) {
                document.getElementById('shopifySetupStatus').innerHTML = `<p class="text-red-400">❌ Setup failed: ${error.message}</p>`;
            }
        }

        // Check Shopify Status
        async function checkShopifyStatus() {
            try {
                const response = await fetch('/shopify/status');
                const data = await response.json();
                
                const statusElement = document.getElementById('shopifyStatus');
                if (data.status === 'connected') {
                    statusElement.textContent = 'Connected';
                    statusElement.className = 'text-green-400';
                } else if (data.status === 'configured') {
                    statusElement.textContent = 'Configured';
                    statusElement.className = 'text-yellow-400';
                } else {
                    statusElement.textContent = 'Not Connected';
                    statusElement.className = 'text-red-400';
                }
            } catch (error) {
                document.getElementById('shopifyStatus').textContent = 'Error';
                document.getElementById('shopifyStatus').className = 'text-red-400';
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadOverviewData();
            checkShopifyStatus();
        });
    </script>
</body>
</html>
